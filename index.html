<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JulineMart HR System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-purple': '#7c3aed',
                        'brand-orange': '#f97316',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SUPABASE_URL = 'https://uttpqcovbuxaheguqvyo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0dHBxY292YnV4YWhlZ3VxdnlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNjIwMTUsImV4cCI6MjA3NDgzODAxNX0.DSoOumPSSZKfs4e308-vTP6BItl-Bx8SWUHqz6ALKa0';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const Icons = {
            Users: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Dollar: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Calendar: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Clock: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Chart: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
            Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            Edit: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Trash: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            Download: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            Lock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>,
            Logout: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
            Settings: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        };

        const generatePDFPayslip = async (payroll, employee, settings, event = null) => {
            // Show loading state
            const button = event ? event.currentTarget : null;
            const originalText = button ? button.innerHTML : '';
            if (button) {
                button.disabled = true;
                button.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Generating...';
            }
            
            // Ensure jsPDF is fully loaded before proceeding
            if (!window.jspdf || !window.jspdf.jsPDF) {
                console.error('jsPDF not loaded yet, retrying...');
                await new Promise(resolve => setTimeout(resolve, 200));
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    alert('PDF library is still loading. Please try again in a moment.');
                    if (button) {
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }
                    return;
                }
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
            
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            let yPos = 20;

            doc.setFillColor(245, 247, 250);
            doc.rect(0, 0, pageWidth, 45, 'F');
            
            if (settings.logo_url) {
                try {
                    doc.addImage(settings.logo_url, 'PNG', margin, 10, 30, 30);
                } catch (e) {
                    console.log('Logo loading skipped');
                }
            }

            doc.setTextColor(44, 62, 80);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text(settings.company_name || 'JulineMart', pageWidth - margin, 18, { align: 'right' });
            
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(100, 100, 100);
            const addressLines = (settings.company_address || '').split('\n');
            addressLines.forEach((line, i) => {
                doc.text(line, pageWidth - margin, 26 + (i * 4), { align: 'right' });
            });

            doc.setTextColor(44, 62, 80);
            yPos = 58;
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('PAYSLIP', pageWidth / 2, yPos, { align: 'center' });
            
            yPos += 3;
            doc.setLineWidth(1.5);
            doc.setDrawColor(52, 152, 219);
            doc.line(pageWidth / 2 - 20, yPos, pageWidth / 2 + 20, yPos);

            yPos += 12;

            doc.setFillColor(245, 247, 250);
            doc.rect(margin, yPos, pageWidth - 2 * margin, 40, 'F');
            doc.setDrawColor(200, 200, 200);
            doc.rect(margin, yPos, pageWidth - 2 * margin, 40);

            yPos += 8;
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(52, 73, 94);

            const labelX = margin + 5;
            const valueX = margin + 50;
            
            doc.text('Employee Name:', labelX, yPos);
            doc.setFont(undefined, 'normal');
            doc.text(payroll.employee_name, valueX, yPos);

            doc.setFont(undefined, 'bold');
            doc.text('Employee Code:', labelX, yPos + 7);
            doc.setFont(undefined, 'normal');
            doc.text(employee.employee_code || 'N/A', valueX, yPos + 7);

            doc.setFont(undefined, 'bold');
            doc.text('Designation:', labelX, yPos + 14);
            doc.setFont(undefined, 'normal');
            doc.text(employee.position || 'N/A', valueX, yPos + 14);

            doc.setFont(undefined, 'bold');
            doc.text('Department:', labelX, yPos + 21);
            doc.setFont(undefined, 'normal');
            doc.text(employee.department || 'N/A', valueX, yPos + 21);

            const rightLabelX = pageWidth / 2 + 10;
            const rightValueX = pageWidth / 2 + 50;
            
            doc.setFont(undefined, 'bold');
            doc.text('Payslip No:', rightLabelX, yPos);
            doc.setFont(undefined, 'normal');
            doc.text(payroll.payslip_no || 'N/A', rightValueX, yPos);

            doc.setFont(undefined, 'bold');
            doc.text('Pay Period:', rightLabelX, yPos + 7);
            doc.setFont(undefined, 'normal');
            const payPeriod = payroll.pay_period_start && payroll.pay_period_end 
                ? `${payroll.pay_period_start} to ${payroll.pay_period_end}`
                : `${payroll.month} ${payroll.year}`;
            doc.text(payPeriod, rightValueX, yPos + 7);

            doc.setFont(undefined, 'bold');
            doc.text('Working Days:', rightLabelX, yPos + 14);
            doc.setFont(undefined, 'normal');
            doc.text(String(payroll.working_days || 30), rightValueX, yPos + 14);

            doc.setFont(undefined, 'bold');
            doc.text('Payment Mode:', rightLabelX, yPos + 21);
            doc.setFont(undefined, 'normal');
            doc.text(employee.payment_mode || 'Bank Transfer', rightValueX, yPos + 21);

            yPos += 35;

            if (employee.bank_name) {
                doc.setFillColor(250, 250, 250);
                doc.rect(margin, yPos, pageWidth - 2 * margin, 12, 'F');
                doc.setDrawColor(200, 200, 200);
                doc.rect(margin, yPos, pageWidth - 2 * margin, 12);
                
                yPos += 8;
                doc.setFont(undefined, 'bold');
                doc.setFontSize(9);
                doc.text('Bank Details:', margin + 5, yPos);
                doc.setFont(undefined, 'normal');
                doc.text(`${employee.bank_name} - ${employee.bank_account || 'N/A'}`, margin + 35, yPos);
                yPos += 8;
            } else {
                yPos += 5;
            }

            const tableTop = yPos;
            const colWidth = (pageWidth - 2 * margin) / 2 - 2;

            doc.setFillColor(52, 152, 219);
            doc.rect(margin, tableTop, colWidth, 10, 'F');
            doc.rect(pageWidth / 2 + 1, tableTop, colWidth, 10, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, 'bold');
            doc.setFontSize(11);
            doc.text('EARNINGS', margin + colWidth / 2, tableTop + 7, { align: 'center' });
            doc.text('DEDUCTIONS', pageWidth / 2 + 1 + colWidth / 2, tableTop + 7, { align: 'center' });

            yPos = tableTop + 15;

            doc.setTextColor(52, 73, 94);
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);

            const earningsData = [];
            earningsData.push(['Basic Salary', parseFloat(payroll.basic_salary || 0).toLocaleString()]);
            
            if (payroll.overtime_pay > 0) earningsData.push(['Overtime Pay', parseFloat(payroll.overtime_pay).toLocaleString()]);
            if (payroll.holiday_pay > 0) earningsData.push(['Holiday Pay', parseFloat(payroll.holiday_pay).toLocaleString()]);
            if (payroll.bonus > 0) earningsData.push(['Bonus/Incentive', parseFloat(payroll.bonus).toLocaleString()]);
            if (payroll.allowances > 0) earningsData.push(['Allowances', parseFloat(payroll.allowances).toLocaleString()]);

            const deductionsData = [];
            if (payroll.tax > 0) deductionsData.push(['Tax (PAYE)', parseFloat(payroll.tax).toLocaleString()]);
            if (payroll.pension > 0) deductionsData.push(['Pension', parseFloat(payroll.pension).toLocaleString()]);
            if (payroll.nhf > 0) deductionsData.push(['NHF', parseFloat(payroll.nhf).toLocaleString()]);
            if (payroll.loan_deduction > 0) deductionsData.push(['Loan Repayment', parseFloat(payroll.loan_deduction).toLocaleString()]);
            if (payroll.other_deductions > 0) deductionsData.push(['Other Deductions', parseFloat(payroll.other_deductions).toLocaleString()]);

            const maxRows = Math.max(earningsData.length, deductionsData.length);

            for (let i = 0; i < maxRows; i++) {
                if (i < earningsData.length) {
                    doc.setFont(undefined, 'normal');
                    doc.text(earningsData[i][0], margin + 5, yPos);
                    doc.text('NGN ' + earningsData[i][1], margin + colWidth - 5, yPos, { align: 'right' });
                }
                
                if (i < deductionsData.length) {
                    doc.text(deductionsData[i][0], pageWidth / 2 + 6, yPos);
                    doc.text('NGN ' + deductionsData[i][1], pageWidth / 2 + colWidth - 4, yPos, { align: 'right' });
                }
                
                yPos += 7;
            }

            yPos += 3;

            doc.setDrawColor(200, 200, 200);
            doc.line(margin, yPos, margin + colWidth, yPos);
            doc.line(pageWidth / 2 + 1, yPos, pageWidth / 2 + 1 + colWidth, yPos);
            
            yPos += 8;
            doc.setFont(undefined, 'bold');
            doc.setFontSize(11);
            doc.text('Total Earnings', margin + 5, yPos);
            doc.text('NGN ' + parseFloat(payroll.gross_salary || 0).toLocaleString(), margin + colWidth - 5, yPos, { align: 'right' });

            const totalDeductions = parseFloat(payroll.tax || 0) + parseFloat(payroll.pension || 0) + 
                                   parseFloat(payroll.nhf || 0) + parseFloat(payroll.loan_deduction || 0) + 
                                   parseFloat(payroll.other_deductions || 0);
            
            doc.text('Total Deductions', pageWidth / 2 + 6, yPos);
            doc.text('NGN ' + totalDeductions.toLocaleString(), pageWidth / 2 + colWidth - 4, yPos, { align: 'right' });

            yPos += 12;

// Draw a line separator instead of colored box
doc.setDrawColor(46, 204, 113);
doc.setLineWidth(0.5);
doc.line(margin, yPos - 2, pageWidth - margin, yPos - 2);

doc.setTextColor(46, 204, 113);
doc.setFontSize(14);
doc.setFont(undefined, 'bold');
doc.text('NET PAY', margin + 5, yPos + 5);
doc.text('NGN ' + parseFloat(payroll.net_salary || 0).toLocaleString(), pageWidth - margin - 5, yPos + 5, { align: 'right' });

            if (payroll.comments) {
                yPos += 20;
                doc.setTextColor(52, 73, 94);
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Comments:', margin, yPos);
                doc.setFont(undefined, 'normal');
                const splitComments = doc.splitTextToSize(payroll.comments, pageWidth - 2 * margin - 10);
                doc.text(splitComments, margin + 5, yPos + 5);
            }

            const footerY = doc.internal.pageSize.height - 35;
            doc.setTextColor(120, 120, 120);
            doc.setFontSize(8);
            doc.setFont(undefined, 'italic');
            const footerText = settings.payslip_footer || 'This is a computer-generated payslip and does not require a signature.';
            const splitFooter = doc.splitTextToSize(footerText, pageWidth - 40);
            doc.text(splitFooter, pageWidth / 2, footerY, { align: 'center' });
            
            doc.setFont(undefined, 'normal');
            
            // Add digital signature/stamp if available
            if (settings.digital_signature_url) {
                try {
                    // Add the signature image - moved higher for better visibility
                    const signatureY = footerY - 18;
                    doc.addImage(settings.digital_signature_url, 'PNG', pageWidth - margin - 60, signatureY, 50, 15);
                } catch (e) {
                    console.log('Digital signature loading skipped:', e);
                    // Fallback: draw signature line if image fails
                    doc.line(pageWidth - margin - 50, footerY - 8, pageWidth - margin - 5, footerY - 8);
                }
            } else {
                // Default signature line - moved higher
                doc.line(pageWidth - margin - 50, footerY - 8, pageWidth - margin - 5, footerY - 8);
            }
            
            doc.setFontSize(9);
            doc.text('Authorized Signature', pageWidth - margin, footerY - 3, { align: 'right' });

            doc.save(`Payslip_${payroll.employee_name}_${payroll.month}_${payroll.year}.pdf`);
            
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Reset button state
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalText;
                }
            }
        };

        function App() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userRole, setUserRole] = useState('');
            const [currentUserId, setCurrentUserId] = useState(null);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [loginError, setLoginError] = useState('');
            const [activeTab, setActiveTab] = useState('dashboard');
            const [employees, setEmployees] = useState([]);
            const [payrolls, setPayrolls] = useState([]);
            const [leaveRequests, setLeaveRequests] = useState([]);
            const [attendance, setAttendance] = useState([]);
            const [settings, setSettings] = useState({});
            const [loading, setLoading] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editingItem, setEditingItem] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [showChangePassword, setShowChangePassword] = useState(false);
            const [showResetPassword, setShowResetPassword] = useState(false);
            const [resetPasswordForm, setResetPasswordForm] = useState({ email: '' });
            const [resetPasswordMessage, setResetPasswordMessage] = useState('');
            const [showAdminPasswordManagement, setShowAdminPasswordManagement] = useState(false);
            const [selectedEmployeeForPassword, setSelectedEmployeeForPassword] = useState(null);
            const [adminPasswordForm, setAdminPasswordForm] = useState({ newPassword: '', confirmPassword: '' });
            const [passwordManagementMessage, setPasswordManagementMessage] = useState('');
            const [showProfileDropdown, setShowProfileDropdown] = useState(false);

            const [employeeForm, setEmployeeForm] = useState({
    name: '', email: '', position: '', department: '', salary: '', joinDate: '', leaveBalance: 20,
    employeeCode: '', bankName: '', bankAccount: '', paymentMode: 'Bank', phone: '', profilePic: ''
});
            const [payrollForm, setPayrollForm] = useState({
                employeeId: '', month: '', year: '', basicSalary: '', 
                allowances: 0, overtimePay: 0, holidayPay: 0, bonus: 0,
                tax: 0, pension: 0, nhf: 0, loanDeduction: 0, otherDeductions: 0,
                taxRate: 10, workingDays: 30, payPeriodStart: '', payPeriodEnd: '', comments: ''
            });
            const [leaveForm, setLeaveForm] = useState({
                employeeId: '', startDate: '', endDate: '', reason: '', type: 'Annual'
            });
            const [attendanceForm, setAttendanceForm] = useState({
                employeeId: '', date: '', status: 'Present'
            });
            const [settingsForm, setSettingsForm] = useState({});
            const [passwordForm, setPasswordForm] = useState({
                currentPassword: '', newPassword: '', confirmPassword: ''
            });

            useEffect(() => {
                const loggedIn = localStorage.getItem('julinemart_logged_in');
                const role = localStorage.getItem('julinemart_user_role');
                const userId = localStorage.getItem('julinemart_user_id');
                if (loggedIn === 'true') {
                    setIsLoggedIn(true);
                    setUserRole(role || 'admin');
                    setCurrentUserId(userId ? parseInt(userId) : null);
                }
            }, []);

            useEffect(() => {
                if (isLoggedIn) {
                    loadAllData();
                    loadSettings();
                }
            }, [isLoggedIn]);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (showProfileDropdown && !event.target.closest('.profile-dropdown-container')) {
                        setShowProfileDropdown(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [showProfileDropdown]);

            const loadSettings = async () => {
                try {
                    const { data } = await supabase.from('company_settings').select('*').eq('id', 1).single();
                    if (data) {
                        setSettings(data);
                        setSettingsForm(data);
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
            };

            const saveSettings = async () => {
                setLoading(true);
                try {
                    const { error } = await supabase
                        .from('company_settings')
                        .upsert({ id: 1, ...settingsForm, updated_at: new Date().toISOString() });
                    
                    if (error) throw error;
                    await loadSettings();
                    alert('Settings saved successfully!');
                } catch (error) {
                    alert('Error saving settings: ' + error.message);
                }
                setLoading(false);
            };

            const handleLogin = async () => {
                setLoginError('');
                setLoading(true);

                try {
                    const { data: adminData } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('username', loginForm.username)
                        .eq('password', loginForm.password)
                        .single();

                    if (adminData) {
                        setIsLoggedIn(true);
                        setUserRole('admin');
                        localStorage.setItem('julinemart_logged_in', 'true');
                        localStorage.setItem('julinemart_user_role', 'admin');
                        localStorage.setItem('julinemart_user_id', adminData.id);
                        setCurrentUserId(adminData.id);
                        setLoginForm({ username: '', password: '' });
                    } else {
    const { data: empData } = await supabase
        .from('employees')
        .select('*')
        .eq('email', loginForm.username)
        .single();

    if (empData) {
        // Check if password matches or use default if no password set
        const employeePassword = empData.password || 'employee123';
        if (employeePassword === loginForm.password) {
            setIsLoggedIn(true);
            setUserRole('employee');
            setCurrentUserId(empData.id);
            localStorage.setItem('julinemart_logged_in', 'true');
            localStorage.setItem('julinemart_user_role', 'employee');
            localStorage.setItem('julinemart_user_id', empData.id);
            setLoginForm({ username: '', password: '' });
        } else {
            setLoginError('Invalid email or password');
        }
    } else {
        setLoginError('Invalid email or password');
    }
}
                } catch (err) {
                    setLoginError('Login failed. Please check your credentials.');
                }

                setLoading(false);
            };

            const handleChangePassword = async () => {
                if (passwordForm.newPassword !== passwordForm.confirmPassword) {
                    alert('New passwords do not match!');
                    return;
                }

                setLoading(true);
                try {
                    const { data } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('password', passwordForm.currentPassword)
                        .single();

                    if (!data) {
                        alert('Current password is incorrect!');
                        setLoading(false);
                        return;
                    }

                    await supabase
                        .from('admin_users')
                        .update({ password: passwordForm.newPassword })
                        .eq('id', data.id);

                    alert('Password changed successfully!');
                    setShowChangePassword(false);
                    setPasswordForm({ currentPassword: '', newPassword: '', confirmPassword: '' });
                } catch (error) {
                    alert('Error changing password: ' + error.message);
                }
                setLoading(false);
            };

            const handleResetPassword = async () => {
                if (!resetPasswordForm.email) {
                    alert('Please enter your email address');
                    return;
                }

                setLoading(true);
                setResetPasswordMessage('');
                
                try {
                    // Check if email exists in admin_users table
                    const { data: adminData } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('username', resetPasswordForm.email)
                        .single();

                    if (adminData) {
                        // Generate a temporary password
                        const tempPassword = 'temp' + Math.random().toString(36).substring(2, 8);
                        
                        // Update the password in database
                        await supabase
                            .from('admin_users')
                            .update({ password: tempPassword })
                            .eq('id', adminData.id);
                        
                        setResetPasswordMessage(`Password reset successful! Your temporary password is: ${tempPassword}. Please login and change your password immediately.`);
                    } else {
                        // Check if email exists in employees table
                        const { data: empData } = await supabase
                            .from('employees')
                            .select('*')
                            .eq('email', resetPasswordForm.email)
                            .single();

                        if (empData) {
                            // Reset employee password to default
                            const newPassword = 'employee123';
                            
                            await supabase
                                .from('employees')
                                .update({ password: newPassword })
                                .eq('id', empData.id);
                            
                            setResetPasswordMessage(`Password reset successful! Your password has been reset to: ${newPassword}. Please login and ask your admin to change it.`);
                        } else {
                            setResetPasswordMessage('No account found with this email address.');
                        }
                    }
                } catch (error) {
                    setResetPasswordMessage('Error resetting password. Please try again.');
                    console.error('Reset password error:', error);
                }
                
                setLoading(false);
            };

            const handleAdminResetEmployeePassword = async (employeeId) => {
                if (!employeeId) {
                    alert('Please select an employee');
                    return;
                }

                setLoading(true);
                setPasswordManagementMessage('');
                
                try {
                    const employee = employees.find(e => e.id === employeeId);
                    if (!employee) {
                        throw new Error('Employee not found');
                    }

                    // Reset to default password
                    const defaultPassword = 'employee123';
                    
                    const { error } = await supabase
                        .from('employees')
                        .update({ password: defaultPassword })
                        .eq('id', employeeId);
                    
                    if (error) throw error;
                    
                    setPasswordManagementMessage(`Password for ${employee.name} has been reset to: ${defaultPassword}`);
                } catch (error) {
                    setPasswordManagementMessage('Error resetting password: ' + error.message);
                    console.error('Admin reset password error:', error);
                }
                
                setLoading(false);
            };

            const handleAdminChangeEmployeePassword = async () => {
                if (!selectedEmployeeForPassword) {
                    alert('Please select an employee');
                    return;
                }

                if (!adminPasswordForm.newPassword || adminPasswordForm.newPassword.length < 6) {
                    alert('Password must be at least 6 characters long');
                    return;
                }

                if (adminPasswordForm.newPassword !== adminPasswordForm.confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }

                setLoading(true);
                setPasswordManagementMessage('');
                
                try {
                    const employee = employees.find(e => e.id === selectedEmployeeForPassword);
                    if (!employee) {
                        throw new Error('Employee not found');
                    }
                    
                    const { error } = await supabase
                        .from('employees')
                        .update({ password: adminPasswordForm.newPassword })
                        .eq('id', selectedEmployeeForPassword);
                    
                    if (error) throw error;
                    
                    setPasswordManagementMessage(`Password for ${employee.name} has been updated successfully`);
                    setAdminPasswordForm({ newPassword: '', confirmPassword: '' });
                    setSelectedEmployeeForPassword(null);
                } catch (error) {
                    setPasswordManagementMessage('Error changing password: ' + error.message);
                    console.error('Admin change password error:', error);
                }
                
                setLoading(false);
            };

            const openAdminPasswordManagement = () => {
                setShowAdminPasswordManagement(true);
                setPasswordManagementMessage('');
                setAdminPasswordForm({ newPassword: '', confirmPassword: '' });
                setSelectedEmployeeForPassword(null);
            };

            const closeAdminPasswordManagement = () => {
                setShowAdminPasswordManagement(false);
                setPasswordManagementMessage('');
                setAdminPasswordForm({ newPassword: '', confirmPassword: '' });
                setSelectedEmployeeForPassword(null);
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setUserRole('');
                setCurrentUserId(null);
                localStorage.removeItem('julinemart_logged_in');
                localStorage.removeItem('julinemart_user_role');
                localStorage.removeItem('julinemart_user_id');
                setActiveTab('dashboard');
            };

            const loadAllData = async () => {
                setLoading(true);
                try {
                    if (userRole === 'employee') {
                        const [empData, payData, leaveData, attData] = await Promise.all([
                            supabase.from('employees').select('*').eq('id', currentUserId).single(),
                            supabase.from('payrolls').select('*').eq('employee_id', currentUserId).order('id', { ascending: false }),
                            supabase.from('leave_requests').select('*').eq('employee_id', currentUserId).order('id', { ascending: false }),
                            supabase.from('attendance').select('*').eq('employee_id', currentUserId).order('date', { ascending: false })
                        ]);

                        if (empData.data) setEmployees([empData.data]);
                        if (payData.data) setPayrolls(payData.data);
                        if (leaveData.data) setLeaveRequests(leaveData.data);
                        if (attData.data) setAttendance(attData.data);
                    } else {
                        const [empData, payData, leaveData, attData] = await Promise.all([
                            supabase.from('employees').select('*').order('id', { ascending: true }),
                            supabase.from('payrolls').select('*').order('id', { ascending: false }),
                            supabase.from('leave_requests').select('*').order('id', { ascending: false }),
                            supabase.from('attendance').select('*').order('date', { ascending: false })
                        ]);

                        if (empData.data) setEmployees(empData.data);
                        if (payData.data) setPayrolls(payData.data);
                        if (leaveData.data) setLeaveRequests(leaveData.data);
                        if (attData.data) setAttendance(attData.data);
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                }
                setLoading(false);
            };

            const openModal = (type, item = null) => {
    setModalType(type);
    setEditingItem(item);
    if (item && type === 'employee') {
        setEmployeeForm({
            name: item.name,
            email: item.email,
            position: item.position,
            department: item.department,
            salary: item.salary,
            joinDate: item.join_date,
            leaveBalance: item.leave_balance,
            employeeCode: item.employee_code || '',
            bankName: item.bank_name || '',
            bankAccount: item.bank_account || '',
            paymentMode: item.payment_mode || 'Bank',
            phone: item.phone || '',
            profilePic: item.profile_pic || ''
        });
    }
    setShowModal(true);
};

            const closeModal = () => {
    setShowModal(false);
    setEditingItem(null);
    setEmployeeForm({ name: '', email: '', position: '', department: '', salary: '', joinDate: '', leaveBalance: 20, employeeCode: '', bankName: '', bankAccount: '', paymentMode: 'Bank', phone: '', profilePic: '' });
    setPayrollForm({ employeeId: '', month: '', year: '', basicSalary: '', allowances: 0, overtimePay: 0, holidayPay: 0, bonus: 0, tax: 0, pension: 0, nhf: 0, loanDeduction: 0, otherDeductions: 0, taxRate: 10, workingDays: 30, payPeriodStart: '', payPeriodEnd: '', comments: '' });
    setLeaveForm({ employeeId: '', startDate: '', endDate: '', reason: '', type: 'Annual' });
    setAttendanceForm({ employeeId: '', date: '', status: 'Present' });
};
            const handleAddEmployee = async () => {
    // Validate required fields
    if (!employeeForm.name || !employeeForm.email || !employeeForm.position || !employeeForm.salary) {
        alert('Please fill in all required fields: Name, Email, Position, and Salary');
        return;
    }

    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(employeeForm.email)) {
        alert('Please enter a valid email address');
        return;
    }

    setLoading(true);
    try {
        const employeeData = {
            name: employeeForm.name,
            email: employeeForm.email,
            position: employeeForm.position,
            department: employeeForm.department || '',
            salary: parseFloat(employeeForm.salary),
            join_date: employeeForm.joinDate || new Date().toISOString().split('T')[0],
            leave_balance: parseInt(employeeForm.leaveBalance) || 20,
            employee_code: employeeForm.employeeCode || '',
            bank_name: employeeForm.bankName || '',
            bank_account: employeeForm.bankAccount || '',
            payment_mode: employeeForm.paymentMode || 'Bank',
            phone: employeeForm.phone || '',
            profile_pic: employeeForm.profilePic || '',
            password: 'employee123'
        };

        console.log('Attempting to save employee:', employeeData);

        let result;
        if (editingItem) {
            result = await supabase.from('employees').update(employeeData).eq('id', editingItem.id);
        } else {
            result = await supabase.from('employees').insert([employeeData]);
        }

        console.log('Save result:', result);

        if (result.error) {
            throw result.error;
        }

        alert('Employee saved successfully!');
        await loadAllData();
        closeModal();
    } catch (error) {
        console.error('Full error:', error);
        alert('Error saving employee: ' + error.message);
    }
    setLoading(false);
};

            const handleDeleteEmployee = async (id) => {
    if (confirm('Are you sure you want to delete this employee? This will also delete all their related records.')) {
        setLoading(true);
        try {
            const { error } = await supabase.from('employees').delete().eq('id', id);
            if (error) throw error;
            alert('Employee deleted successfully');
            await loadAllData();
        } catch (error) {
            alert('Error deleting employee: ' + error.message);
        }
        setLoading(false);
    }
};

            const handleDeletePayroll = async (id) => {
                if (confirm('Are you sure you want to delete this payroll record? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('payrolls').delete().eq('id', id);
                        if (error) throw error;
                        alert('Payroll deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting payroll: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleDeleteLeave = async (id) => {
                if (confirm('Are you sure you want to delete this leave request? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('leave_requests').delete().eq('id', id);
                        if (error) throw error;
                        alert('Leave request deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting leave request: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleDeleteAttendance = async (id) => {
                if (confirm('Are you sure you want to delete this attendance record? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('attendance').delete().eq('id', id);
                        if (error) throw error;
                        alert('Attendance record deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting attendance record: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleAddPayroll = async () => {
    // Validate required fields
    if (!payrollForm.employeeId) {
        alert('Please select an employee');
        return;
    }
    
    if (!payrollForm.month) {
        alert('Please select a month');
        return;
    }
    
    if (!payrollForm.year) {
        alert('Please enter a year');
        return;
    }

    const employee = employees.find(e => e.id === parseInt(payrollForm.employeeId));
    if (!employee) {
        alert('Employee not found');
        return;
    }

    setLoading(true);
    try {
        const basicSalary = parseFloat(payrollForm.basicSalary) || employee.salary;
        const allowances = parseFloat(payrollForm.allowances) || 0;
        const overtimePay = parseFloat(payrollForm.overtimePay) || 0;
        const holidayPay = parseFloat(payrollForm.holidayPay) || 0;
        const bonus = parseFloat(payrollForm.bonus) || 0;
        
        const grossSalary = basicSalary + allowances + overtimePay + holidayPay + bonus;
        
        const tax = parseFloat(payrollForm.tax) || ((grossSalary * parseFloat(payrollForm.taxRate)) / 100);
        const pension = parseFloat(payrollForm.pension) || 0;
        const nhf = parseFloat(payrollForm.nhf) || 0;
        const loanDeduction = parseFloat(payrollForm.loanDeduction) || 0;
        const otherDeductions = parseFloat(payrollForm.otherDeductions) || 0;

        const totalDeductions = tax + pension + nhf + loanDeduction + otherDeductions;
        const netSalary = grossSalary - totalDeductions;

        const payslipNo = `PY${String(payrolls.length + 1).padStart(4, '0')}`;

        const payrollData = {
            employee_id: employee.id,
            employee_name: employee.name,
            month: payrollForm.month,
            year: parseInt(payrollForm.year),
            basic_salary: basicSalary,
            allowances: allowances,
            overtime_pay: overtimePay,
            holiday_pay: holidayPay,
            bonus: bonus,
            tax: tax,
            pension: pension,
            nhf: nhf,
            loan_deduction: loanDeduction,
            other_deductions: otherDeductions,
            gross_salary: grossSalary,
            net_salary: netSalary,
            payslip_no: payslipNo,
            working_days: parseInt(payrollForm.workingDays) || 30,
            pay_period_start: payrollForm.payPeriodStart || null,
            pay_period_end: payrollForm.payPeriodEnd || null,
            comments: payrollForm.comments || ''
        };

        console.log('Attempting to save payroll:', payrollData);

        const { data, error } = await supabase.from('payrolls').insert([payrollData]);

        if (error) {
            console.error('Payroll save error:', error);
            throw error;
        }

        console.log('Payroll saved successfully:', data);
        alert('Payroll generated successfully!');
        await loadAllData();
        closeModal();
    } catch (error) {
        console.error('Full payroll error:', error);
        alert('Error generating payroll: ' + error.message);
    }
    setLoading(false);
};

            const handleAddLeave = async () => {
                const empId = userRole === 'employee' ? currentUserId : parseInt(leaveForm.employeeId);
                const employee = employees.find(e => e.id === empId) || { id: empId, name: 'You' };

                const startDate = new Date(leaveForm.startDate);
                const endDate = new Date(leaveForm.endDate);
                const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

                setLoading(true);
                try {
                    await supabase.from('leave_requests').insert([{
                        employee_id: employee.id,
                        employee_name: employee.name,
                        start_date: leaveForm.startDate,
                        end_date: leaveForm.endDate,
                        days,
                        reason: leaveForm.reason,
                        type: leaveForm.type,
                        status: 'Pending'
                    }]);
                    await loadAllData();
                    closeModal();
                } catch (error) {
                    alert('Error submitting leave: ' + error.message);
                }
                setLoading(false);
            };

            const handleLeaveAction = async (id, action) => {
                const leave = leaveRequests.find(l => l.id === id);
                if (!leave) return;

                const newStatus = action === 'approve' ? 'Approved' : 'Rejected';
                setLoading(true);
                try {
                    await supabase.from('leave_requests').update({ status: newStatus }).eq('id', id);
                    if (action === 'approve') {
                        const employee = employees.find(e => e.id === leave.employee_id);
                        if (employee) {
                            await supabase.from('employees')
                                .update({ leave_balance: employee.leave_balance - leave.days })
                                .eq('id', leave.employee_id);
                        }
                    }
                    await loadAllData();
                } catch (error) {
                    alert('Error updating leave: ' + error.message);
                }
                setLoading(false);
            };

            const handleAddAttendance = async () => {
                const employee = employees.find(e => e.id === parseInt(attendanceForm.employeeId));
                if (!employee) return;

                setLoading(true);
                try {
                    await supabase.from('attendance').insert([{
                        employee_id: employee.id,
                        employee_name: employee.name,
                        date: attendanceForm.date,
                        status: attendanceForm.status
                    }]);
                    await loadAllData();
                    closeModal();
                } catch (error) {
                    alert('Error marking attendance: ' + error.message);
                }
                setLoading(false);
            };

            const totalSalary = payrolls.reduce((sum, p) => sum + parseFloat(p.net_salary || 0), 0);
            const pendingLeaves = leaveRequests.filter(l => l.status === 'Pending').length;
            const todayDate = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance.filter(a => a.date === todayDate);
            const presentToday = todayAttendance.filter(a => a.status === 'Present').length;

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 to-orange-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                {settings.logo_url && (
                                    <img src={settings.logo_url} alt="Logo" className="h-20 mx-auto mb-4 object-contain" onError={(e) => e.target.style.display = 'none'} />
                                )}
                                <div className="inline-block p-3 bg-purple-100 rounded-full mb-4">
                                    <Icons.Lock />
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800">{settings.company_name || 'JulineMart'}</h1>
                                <p className="text-gray-600 mt-2">HR Management System</p>
                            </div>

                            {loginError && (
                                <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                    {loginError}
                                </div>
                            )}

                            <div className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Username or Email"
                                    value={loginForm.username}
                                    onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                    className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                />
                                <input
                                    type="password"
                                    placeholder="Password"
                                    value={loginForm.password}
                                    onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                    className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                />
                                <button
                                    onClick={handleLogin}
                                    disabled={loading}
                                    className="w-full bg-brand-purple hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-semibold disabled:bg-gray-300"
                                >
                                    {loading ? 'Logging in...' : 'Login'}
                                </button>
                                
                                <button
                                    type="button"
                                    onClick={() => setShowResetPassword(true)}
                                    className="w-full text-brand-purple hover:text-purple-700 text-sm font-medium mt-2"
                                >
                                    Forgot Password?
                                </button>
                            </div>

                            <div className="mt-6 text-center text-sm text-gray-600">
    <p className="text-xs text-gray-500">
        <strong>Admin:</strong> Login with your admin credentials<br />
        <strong>Employee:</strong> Login with your email address
    </p>
</div>
                        </div>
                        
                        {showResetPassword && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-8 max-w-md w-full">
                                    <h3 className="text-2xl font-bold mb-6 text-brand-purple">Reset Password</h3>
                                    
                                    {resetPasswordMessage && (
                                        <div className={`mb-4 p-4 rounded-lg ${
                                            resetPasswordMessage.includes('successful') 
                                                ? 'bg-green-100 border border-green-400 text-green-700'
                                                : 'bg-red-100 border border-red-400 text-red-700'
                                        }`}>
                                            {resetPasswordMessage}
                                        </div>
                                    )}
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Email Address</label>
                                            <input 
                                                type="email" 
                                                placeholder="Enter your email address"
                                                value={resetPasswordForm.email} 
                                                onChange={(e) => setResetPasswordForm({ email: e.target.value })}
                                                className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                                onKeyPress={(e) => e.key === 'Enter' && handleResetPassword()}
                                            />
                                            <p className="text-xs text-gray-500 mt-1">
                                                Enter the email address associated with your account
                                            </p>
                                        </div>
                                        
                                        <div className="flex space-x-3 mt-6">
                                            <button 
                                                onClick={handleResetPassword} 
                                                disabled={loading}
                                                className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-300"
                                            >
                                                {loading ? 'Resetting...' : 'Reset Password'}
                                            </button>
                                            <button 
                                                onClick={() => {
                                                    setShowResetPassword(false);
                                                    setResetPasswordForm({ email: '' });
                                                    setResetPasswordMessage('');
                                                }} 
                                                className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            if (userRole === 'employee') {
                const currentEmployee = employees[0] || {};
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-brand-purple text-white p-4 sm:p-6 shadow-lg">
                            <div className="container mx-auto flex justify-between items-center">
                                <div className="flex items-center space-x-3 sm:space-x-4">
                                    {settings.logo_url && (
                                        <img src={settings.logo_url} alt="Logo" className="h-10 sm:h-12 object-contain" onError={(e) => e.target.style.display = 'none'} />
                                    )}
                                    <div>
                                        <h1 className="text-lg sm:text-xl md:text-2xl font-bold">{settings.company_name || 'JulineMart'}</h1>
                                        <p className="text-purple-100 text-sm">Employee Portal</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-3 sm:space-x-4">
                                    <span className="hidden md:inline text-sm font-medium">Welcome, {currentEmployee.name}</span>
                                    <div className="relative profile-dropdown-container">
                                        <button
                                            onClick={() => setShowProfileDropdown(!showProfileDropdown)}
                                            className="flex items-center space-x-2 hover:bg-purple-600 rounded-lg p-2 transition-colors duration-200"
                                        >
                                            {currentEmployee.profile_pic ? (
                                                <img 
                                                    src={currentEmployee.profile_pic} 
                                                    alt={currentEmployee.name} 
                                                    className="w-10 h-10 rounded-full object-cover border-2 border-white" 
                                                    onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentEmployee.name || 'User') + '&background=7c3aed&color=fff'} 
                                                />
                                            ) : (
                                                <div className="w-10 h-10 rounded-full bg-purple-600 border-2 border-white text-white flex items-center justify-center font-bold">
                                                    {currentEmployee.name ? currentEmployee.name.charAt(0).toUpperCase() : 'U'}
                                                </div>
                                            )}
                                            <svg className={`w-4 h-4 transition-transform duration-200 ${showProfileDropdown ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </button>

                                        {showProfileDropdown && (
                                            <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border z-50 text-gray-800">
                                                <div className="p-6">
                                                    <div className="flex items-center space-x-4 mb-6">
                                                        {currentEmployee.profile_pic ? (
                                                            <img 
                                                                src={currentEmployee.profile_pic} 
                                                                alt={currentEmployee.name} 
                                                                className="w-16 h-16 rounded-full object-cover border-2 border-brand-purple" 
                                                                onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentEmployee.name || 'User') + '&background=7c3aed&color=fff'} 
                                                            />
                                                        ) : (
                                                            <div className="w-16 h-16 rounded-full bg-brand-purple text-white flex items-center justify-center font-bold text-xl border-2 border-brand-purple">
                                                                {currentEmployee.name ? currentEmployee.name.charAt(0).toUpperCase() : 'U'}
                                                            </div>
                                                        )}
                                                        <div>
                                                            <h3 className="text-xl font-bold text-gray-800">{currentEmployee.name || 'N/A'}</h3>
                                                            <p className="text-brand-purple font-medium">{currentEmployee.position || 'N/A'}</p>
                                                            <p className="text-sm text-gray-600">{currentEmployee.employee_code ? `ID: ${currentEmployee.employee_code}` : 'No ID assigned'}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="space-y-3 mb-6">
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Department:</span>
                                                            <span className="font-medium">{currentEmployee.department || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Email:</span>
                                                            <span className="font-medium">{currentEmployee.email || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Phone:</span>
                                                            <span className="font-medium">{currentEmployee.phone || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Join Date:</span>
                                                            <span className="font-medium">{currentEmployee.join_date || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Leave Balance:</span>
                                                            <span className="font-bold text-green-600">{currentEmployee.leave_balance || 0} days</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="border-t pt-4">
                                                        <button
                                                            onClick={() => {
                                                                setShowProfileDropdown(false);
                                                                handleLogout();
                                                            }}
                                                            className="w-full flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200"
                                                        >
                                                            <Icons.Logout />
                                                            <span>Logout</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="container mx-auto px-6 py-8">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-brand-purple">
                                    <p className="text-gray-500 text-sm">Leave Balance</p>
                                    <p className="text-3xl font-bold text-brand-purple">{currentEmployee.leave_balance || 0} days</p>
                                </div>
                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-600">
                                    <p className="text-gray-500 text-sm">Total Payslips</p>
                                    <p className="text-3xl font-bold text-green-600">{payrolls.length}</p>
                                </div>
                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-brand-orange">
                                    <p className="text-gray-500 text-sm">Pending Leaves</p>
                                    <p className="text-3xl font-bold text-brand-orange">{leaveRequests.filter(l => l.status === 'Pending').length}</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-lg shadow-md">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold">My Payslips</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {payrolls.slice(0, 5).map(pay => {
                                            const emp = currentEmployee;
                                            return (
                                                <div key={pay.id} className="border-b py-3 last:border-0 flex justify-between items-center">
                                                    <div>
                                                        <p className="font-semibold">{pay.month} {pay.year}</p>
                                                        <p className="text-sm text-gray-600">{pay.payslip_no}</p>
                                                    </div>
                                                    <div className="flex items-center space-x-3">
                                                        <p className="text-lg font-bold text-green-600">{parseFloat(pay.net_salary).toLocaleString()}</p>
                                                        <button 
                                                            onClick={(e) => generatePDFPayslip(pay, emp, settings, e)} 
                                                            className="bg-brand-orange hover:bg-orange-600 text-white px-3 py-1 rounded-lg text-sm flex items-center space-x-1"
                                                        >
                                                            <Icons.Download />
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        {payrolls.length === 0 && <p className="text-gray-500 text-center py-4">No payslips yet</p>}
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-lg shadow-md">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold">My Leave Requests</h3>
                                        <button
                                            onClick={() => openModal('leave')}
                                            className="bg-brand-purple hover:bg-purple-700 text-white px-3 py-1 rounded-lg text-sm flex items-center space-x-1"
                                        >
                                            <Icons.Plus />
                                            <span>Request</span>
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        {leaveRequests.slice(0, 5).map(leave => (
                                            <div key={leave.id} className="border-b py-3 last:border-0">
                                                <div className="flex justify-between">
                                                    <div>
                                                        <p className="font-semibold">{leave.type} Leave</p>
                                                        <p className="text-sm text-gray-600">{leave.start_date} to {leave.end_date}</p>
                                                        <p className="text-xs text-gray-500">{leave.days} days</p>
                                                    </div>
                                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold h-fit ${
                                                        leave.status === 'Approved' ? 'bg-green-100 text-green-700' :
                                                        leave.status === 'Rejected' ? 'bg-red-100 text-red-700' :
                                                        'bg-yellow-100 text-yellow-700'
                                                    }`}>
                                                        {leave.status}
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                        {leaveRequests.length === 0 && <p className="text-gray-500 text-center py-4">No leave requests yet</p>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {showModal && modalType === 'leave' && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-8 max-w-md w-full max-h-screen overflow-y-auto">
                                    <h3 className="text-2xl font-bold mb-6 text-brand-purple">New Leave Request</h3>
                                    <div className="space-y-4">
                                        <select value={leaveForm.type} onChange={(e) => setLeaveForm({ ...leaveForm, type: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="Annual">Annual Leave</option>
                                            <option value="Sick">Sick Leave</option>
                                            <option value="Emergency">Emergency Leave</option>
                                            <option value="Unpaid">Unpaid Leave</option>
                                        </select>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Start Date</label>
                                            <input type="date" value={leaveForm.startDate} onChange={(e) => setLeaveForm({ ...leaveForm, startDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">End Date</label>
                                            <input type="date" value={leaveForm.endDate} onChange={(e) => setLeaveForm({ ...leaveForm, endDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Reason</label>
                                            <textarea placeholder="Reason for leave" value={leaveForm.reason} onChange={(e) => setLeaveForm({ ...leaveForm, reason: e.target.value })} className="w-full px-4 py-2 border rounded-lg" rows="3" />
                                        </div>
                                        <div className="flex space-x-3">
                                            <button onClick={handleAddLeave} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Submit</button>
                                            <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-brand-purple text-white p-4 sm:p-6 shadow-lg">
                        <div className="container mx-auto flex justify-between items-center">
                            <div className="flex items-center space-x-3 sm:space-x-4">
                                {settings.logo_url && (
                                    <img src={settings.logo_url} alt="Logo" className="h-10 sm:h-12 object-contain" onError={(e) => e.target.style.display = 'none'} />
                                )}
                                <div>
                                    <h1 className="text-lg sm:text-xl md:text-2xl font-bold">{settings.company_name || 'JulineMart'}</h1>
                                    <p className="text-purple-100 text-sm">HR Management System</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-2 sm:space-x-3">
                                <button
                                    onClick={openAdminPasswordManagement}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-purple-700 hover:bg-purple-800 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Password Management"
                                >
                                    <Icons.Lock />
                                    <span className="hidden lg:inline">Password Management</span>
                                    <span className="hidden sm:inline lg:hidden">Passwords</span>
                                </button>
                                <button
                                    onClick={() => setShowChangePassword(true)}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-purple-700 hover:bg-purple-800 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Change Password"
                                >
                                    <Icons.Lock />
                                    <span className="hidden lg:inline">Change Password</span>
                                    <span className="hidden sm:inline lg:hidden">Password</span>
                                </button>
                                <button
                                    onClick={() => setShowSettings(true)}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-purple-700 hover:bg-purple-800 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Settings"
                                >
                                    <Icons.Settings />
                                    <span className="hidden sm:inline">Settings</span>
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-red-600 hover:bg-red-700 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Logout"
                                >
                                    <Icons.Logout />
                                    <span className="hidden sm:inline">Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white shadow-md border-b">
                        <div className="container mx-auto px-6">
                            <div className="flex space-x-1 overflow-x-auto">
                                {[
                                    { id: 'dashboard', icon: Icons.Chart, label: 'Dashboard' },
                                    { id: 'employees', icon: Icons.Users, label: 'Employees' },
                                    { id: 'payroll', icon: Icons.Dollar, label: 'Payroll' },
                                    { id: 'leave', icon: Icons.Calendar, label: 'Leave' },
                                    { id: 'attendance', icon: Icons.Clock, label: 'Attendance' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center space-x-2 px-6 py-4 border-b-2 transition ${
                                            activeTab === tab.id
                                                ? 'border-brand-purple text-brand-purple'
                                                : 'border-transparent text-gray-600 hover:text-brand-purple'
                                        }`}
                                    >
                                        {React.createElement(tab.icon)}
                                        <span className="font-medium">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {loading && (
                        <div className="bg-brand-purple text-white text-center py-2">Loading...</div>
                    )}

                    <div className="container mx-auto px-6 py-8">
                        {activeTab === 'dashboard' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-6">Dashboard</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-brand-purple">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Total Employees</p>
                                                <p className="text-3xl font-bold text-brand-purple">{employees.length}</p>
                                            </div>
                                            <Icons.Users />
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-600">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Total Payroll</p>
                                                <p className="text-3xl font-bold text-green-600">{totalSalary.toLocaleString()}</p>
                                            </div>
                                            <Icons.Dollar />
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-brand-orange">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Pending Leaves</p>
                                                <p className="text-3xl font-bold text-brand-orange">{pendingLeaves}</p>
                                            </div>
                                            <Icons.Calendar />
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-purple-600">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Present Today</p>
                                                <p className="text-3xl font-bold text-purple-600">{presentToday}</p>
                                            </div>
                                            <Icons.Clock />
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="bg-white p-6 rounded-lg shadow-md">
                                        <h3 className="text-xl font-bold mb-4">Recent Employees</h3>
                                        {employees.slice(0, 5).map(emp => (
                                            <div key={emp.id} className="border-b py-3 last:border-0">
                                                <p className="font-semibold">{emp.name}</p>
                                                <p className="text-sm text-gray-600">{emp.position}  {emp.employee_code || 'No Code'}</p>
                                            </div>
                                        ))}
                                        {employees.length === 0 && <p className="text-gray-500 text-center py-4">No employees yet</p>}
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-md">
                                        <h3 className="text-xl font-bold mb-4">Recent Payrolls</h3>
                                        {payrolls.slice(0, 5).map(pay => (
                                            <div key={pay.id} className="border-b py-3 last:border-0 flex justify-between">
                                                <div>
                                                    <p className="font-semibold">{pay.employee_name}</p>
                                                    <p className="text-sm text-gray-600">{pay.month} {pay.year}  {pay.payslip_no}</p>
                                                </div>
                                                <p className="text-lg font-bold text-green-600">{parseFloat(pay.net_salary).toLocaleString()}</p>
                                            </div>
                                        ))}
                                        {payrolls.length === 0 && <p className="text-gray-500 text-center py-4">No payrolls yet</p>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'employees' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Employees</h2>
                                    <button
                                        onClick={() => openModal('employee')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Add Employee</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Position</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bank</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Salary</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {employees.map(emp => (
    <tr key={emp.id}>
        <td className="px-6 py-4">
            <div className="flex items-center space-x-3">
                {emp.profile_pic ? (
                    <img src={emp.profile_pic} alt={emp.name} className="w-10 h-10 rounded-full object-cover" onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(emp.name) + '&background=7c3aed&color=fff'} />
                ) : (
                    <div className="w-10 h-10 rounded-full bg-brand-purple text-white flex items-center justify-center font-bold">
                        {emp.name.charAt(0).toUpperCase()}
                    </div>
                )}
                <div>
                    <p className="font-semibold">{emp.name}</p>
                    <p className="text-sm text-gray-500">{emp.email}</p>
                </div>
            </div>
        </td>
        <td className="px-6 py-4">{emp.employee_code || 'N/A'}</td>
        <td className="px-6 py-4">{emp.position}</td>
        <td className="px-6 py-4">
            <p className="text-sm">{emp.bank_name || 'N/A'}</p>
            <p className="text-xs text-gray-500">{emp.bank_account || ''}</p>
        </td>
        <td className="px-6 py-4">{parseFloat(emp.salary).toLocaleString()}</td>
        <td className="px-6 py-4">
            <div className="flex space-x-2">
                <button onClick={() => openModal('employee', emp)} className="text-blue-600 hover:text-blue-800" title="Edit Employee">
                    <Icons.Edit />
                </button>
                <button onClick={() => handleAdminResetEmployeePassword(emp.id)} className="text-orange-600 hover:text-orange-800" title="Reset Password">
                    <Icons.Lock />
                </button>
                <button onClick={() => handleDeleteEmployee(emp.id)} className="text-red-600 hover:text-red-800" title="Delete Employee">
                    <Icons.Trash />
                </button>
            </div>
        </td>
    </tr>
))}
                                        </tbody>
                                    </table>
                                    {employees.length === 0 && <p className="text-center py-8 text-gray-500">No employees yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'payroll' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Payroll Management</h2>
                                    <button
                                        onClick={() => openModal('payroll')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Generate Payroll</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Payslip No</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Period</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Net Pay</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {payrolls.map(pay => {
                                                const employee = employees.find(e => e.id === pay.employee_id);
                                                return (
                                                    <tr key={pay.id}>
                                                        <td className="px-6 py-4 font-semibold">{pay.employee_name}</td>
                                                        <td className="px-6 py-4">{pay.payslip_no || 'N/A'}</td>
                                                        <td className="px-6 py-4">{pay.month} {pay.year}</td>
                                                        <td className="px-6 py-4 font-bold text-green-600">{parseFloat(pay.net_salary).toLocaleString()}</td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex space-x-2">
                                                                <button 
                                                                    onClick={(e) => generatePDFPayslip(pay, employee || {}, settings, e)} 
                                                                    className="bg-brand-orange hover:bg-orange-600 text-white px-3 py-2 rounded-lg flex items-center space-x-1"
                                                                >
                                                                    <Icons.Download />
                                                                    <span>PDF</span>
                                                                </button>
                                                                <button 
                                                                    onClick={() => handleDeletePayroll(pay.id)} 
                                                                    className="text-red-600 hover:text-red-800 p-2"
                                                                >
                                                                    <Icons.Trash />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                    {payrolls.length === 0 && <p className="text-center py-8 text-gray-500">No payrolls yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'leave' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Leave Management</h2>
                                    <button
                                        onClick={() => openModal('leave')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>New Leave</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Duration</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Days</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reason</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {leaveRequests.map(leave => (
                                                <tr key={leave.id}>
                                                    <td className="px-6 py-4 font-semibold">{leave.employee_name}</td>
                                                    <td className="px-6 py-4 text-sm">{leave.start_date} to {leave.end_date}</td>
                                                    <td className="px-6 py-4">{leave.days}</td>
                                                    <td className="px-6 py-4 text-sm max-w-xs">
                                                        <div className="truncate" title={leave.reason || 'No reason provided'}>
                                                            {leave.reason || 'No reason provided'}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                            leave.status === 'Approved' ? 'bg-green-100 text-green-700' :
                                                            leave.status === 'Rejected' ? 'bg-red-100 text-red-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {leave.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="flex space-x-2">
                                                            {leave.status === 'Pending' && (
                                                                <>
                                                                    <button onClick={() => handleLeaveAction(leave.id, 'approve')} className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                                                        Approve
                                                                    </button>
                                                                    <button onClick={() => handleLeaveAction(leave.id, 'reject')} className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                                                        Reject
                                                                    </button>
                                                                </>
                                                            )}
                                                            <button 
                                                                onClick={() => handleDeleteLeave(leave.id)} 
                                                                className="text-red-600 hover:text-red-800 p-1"
                                                            >
                                                                <Icons.Trash />
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {leaveRequests.length === 0 && <p className="text-center py-8 text-gray-500">No leave requests yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'attendance' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Attendance</h2>
                                    <button
                                        onClick={() => openModal('attendance')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Mark Attendance</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {attendance.map(att => (
                                                <tr key={att.id}>
                                                    <td className="px-6 py-4 font-semibold">{att.employee_name}</td>
                                                    <td className="px-6 py-4">{att.date}</td>
                                                    <td className="px-6 py-4">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                            att.status === 'Present' ? 'bg-green-100 text-green-700' :
                                                            att.status === 'Absent' ? 'bg-red-100 text-red-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {att.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <button 
                                                            onClick={() => handleDeleteAttendance(att.id)} 
                                                            className="text-red-600 hover:text-red-800 p-1"
                                                        >
                                                            <Icons.Trash />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {attendance.length === 0 && <p className="text-center py-8 text-gray-500">No attendance records yet</p>}
                                </div>
                            </div>
                        )}
                    </div>

                    {showModal && modalType === 'employee' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-2xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">{editingItem ? 'Edit' : 'Add'} Employee</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" placeholder="Full Name *" value={employeeForm.name} onChange={(e) => setEmployeeForm({ ...employeeForm, name: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Employee Code" value={employeeForm.employeeCode} onChange={(e) => setEmployeeForm({ ...employeeForm, employeeCode: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="email" placeholder="Email *" value={employeeForm.email} onChange={(e) => setEmployeeForm({ ...employeeForm, email: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Phone" value={employeeForm.phone} onChange={(e) => setEmployeeForm({ ...employeeForm, phone: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Position *" value={employeeForm.position} onChange={(e) => setEmployeeForm({ ...employeeForm, position: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Department" value={employeeForm.department} onChange={(e) => setEmployeeForm({ ...employeeForm, department: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="number" placeholder="Salary *" value={employeeForm.salary} onChange={(e) => setEmployeeForm({ ...employeeForm, salary: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Bank Name" value={employeeForm.bankName} onChange={(e) => setEmployeeForm({ ...employeeForm, bankName: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Bank Account" value={employeeForm.bankAccount} onChange={(e) => setEmployeeForm({ ...employeeForm, bankAccount: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <select value={employeeForm.paymentMode} onChange={(e) => setEmployeeForm({ ...employeeForm, paymentMode: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="Bank">Bank Transfer</option>
                                        <option value="Cash">Cash</option>
                                        <option value="Cheque">Cheque</option>
                                    </select>
                                    <input type="date" placeholder="Join Date" value={employeeForm.joinDate} onChange={(e) => setEmployeeForm({ ...employeeForm, joinDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="number" placeholder="Leave Balance (days)" value={employeeForm.leaveBalance} onChange={(e) => setEmployeeForm({ ...employeeForm, leaveBalance: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium mb-2">Profile Picture URL</label>
                                        <input type="text" placeholder="https://example.com/photo.jpg" value={employeeForm.profilePic} onChange={(e) => setEmployeeForm({ ...employeeForm, profilePic: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        <p className="text-xs text-gray-500 mt-1">Upload photo to GitHub or use direct image URL</p>
                                        {employeeForm.profilePic && (
                                            <div className="mt-2">
                                                <img src={employeeForm.profilePic} alt="Preview" className="w-16 h-16 rounded-full object-cover" onError={(e) => e.target.style.display = 'none'} />
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-700">
                                    <p><strong>Note:</strong> Employee default password is "employee123". They can login with their email.</p>
                                </div>
                                <div className="flex space-x-3 mt-6">
                                    <button onClick={handleAddEmployee} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Save</button>
                                    <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'payroll' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Generate Payroll</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium mb-1">Select Employee *</label>
                                        <select value={payrollForm.employeeId} onChange={(e) => setPayrollForm({ ...payrollForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="">Select Employee</option>
                                            {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name} ({emp.employee_code || emp.id})</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Month *</label>
                                        <select value={payrollForm.month} onChange={(e) => setPayrollForm({ ...payrollForm, month: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="">Select Month</option>
                                            {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map(m => <option key={m} value={m}>{m}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Year *</label>
                                        <input type="number" placeholder="2024" value={payrollForm.year} onChange={(e) => setPayrollForm({ ...payrollForm, year: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Pay Period Start</label>
                                        <input type="date" value={payrollForm.payPeriodStart} onChange={(e) => setPayrollForm({ ...payrollForm, payPeriodStart: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Pay Period End</label>
                                        <input type="date" value={payrollForm.payPeriodEnd} onChange={(e) => setPayrollForm({ ...payrollForm, payPeriodEnd: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Working Days (Total days worked this period)</label>
                                        <input type="number" placeholder="30" value={payrollForm.workingDays} onChange={(e) => setPayrollForm({ ...payrollForm, workingDays: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                </div>

                                <div className="border-t pt-4 mb-4">
                                    <h4 className="font-bold text-green-700 mb-3"> EARNINGS (Income)</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Basic Salary (Leave empty to use default)</label>
                                            <input type="number" placeholder="Auto from employee record" value={payrollForm.basicSalary} onChange={(e) => setPayrollForm({ ...payrollForm, basicSalary: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Allowances (Transport, Housing, etc.)</label>
                                            <input type="number" placeholder="0" value={payrollForm.allowances} onChange={(e) => setPayrollForm({ ...payrollForm, allowances: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Overtime Pay</label>
                                            <input type="number" placeholder="0" value={payrollForm.overtimePay} onChange={(e) => setPayrollForm({ ...payrollForm, overtimePay: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Holiday Pay</label>
                                            <input type="number" placeholder="0" value={payrollForm.holidayPay} onChange={(e) => setPayrollForm({ ...payrollForm, holidayPay: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Bonus / Incentive / Commission</label>
                                            <input type="number" placeholder="0" value={payrollForm.bonus} onChange={(e) => setPayrollForm({ ...payrollForm, bonus: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                    </div>
                                </div>

                                <div className="border-t pt-4 mb-4">
                                    <h4 className="font-bold text-red-700 mb-3"> DEDUCTIONS</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tax/PAYE (Or use % below)</label>
                                            <input type="number" placeholder="0" value={payrollForm.tax} onChange={(e) => setPayrollForm({ ...payrollForm, tax: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tax Rate % (If amount above is 0)</label>
                                            <input type="number" placeholder="10" value={payrollForm.taxRate} onChange={(e) => setPayrollForm({ ...payrollForm, taxRate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Pension Contribution</label>
                                            <input type="number" placeholder="0" value={payrollForm.pension} onChange={(e) => setPayrollForm({ ...payrollForm, pension: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">NHF (National Housing Fund)</label>
                                            <input type="number" placeholder="0" value={payrollForm.nhf} onChange={(e) => setPayrollForm({ ...payrollForm, nhf: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Loan Repayment</label>
                                            <input type="number" placeholder="0" value={payrollForm.loanDeduction} onChange={(e) => setPayrollForm({ ...payrollForm, loanDeduction: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Other Deductions (Insurance, etc.)</label>
                                            <input type="number" placeholder="0" value={payrollForm.otherDeductions} onChange={(e) => setPayrollForm({ ...payrollForm, otherDeductions: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                    </div>
                                </div>

                                <div className="border-t pt-4">
                                    <label className="block text-sm font-medium mb-1">Comments (Optional)</label>
                                    <textarea placeholder="Any additional notes..." value={payrollForm.comments} onChange={(e) => setPayrollForm({ ...payrollForm, comments: e.target.value })} className="w-full px-4 py-2 border rounded-lg" rows="3" />
                                </div>

                                <div className="flex space-x-3 mt-6">
                                    <button onClick={handleAddPayroll} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Generate Payroll</button>
                                    <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'leave' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">New Leave Request</h3>
                                <div className="space-y-4">
                                    <select value={leaveForm.employeeId} onChange={(e) => setLeaveForm({ ...leaveForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="">Select Employee *</option>
                                        {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                                    </select>
                                    <select value={leaveForm.type} onChange={(e) => setLeaveForm({ ...leaveForm, type: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="Annual">Annual Leave</option>
                                        <option value="Sick">Sick Leave</option>
                                        <option value="Emergency">Emergency Leave</option>
                                        <option value="Unpaid">Unpaid Leave</option>
                                    </select>
                                    <input type="date" value={leaveForm.startDate} onChange={(e) => setLeaveForm({ ...leaveForm, startDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="date" value={leaveForm.endDate} onChange={(e) => setLeaveForm({ ...leaveForm, endDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <textarea placeholder="Reason" value={leaveForm.reason} onChange={(e) => setLeaveForm({ ...leaveForm, reason: e.target.value })} className="w-full px-4 py-2 border rounded-lg" rows="3" />
                                    <div className="flex space-x-3">
                                        <button onClick={handleAddLeave} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Submit</button>
                                        <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'attendance' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Mark Attendance</h3>
                                <div className="space-y-4">
                                    <select value={attendanceForm.employeeId} onChange={(e) => setAttendanceForm({ ...attendanceForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="">Select Employee *</option>
                                        {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                                    </select>
                                    <input type="date" value={attendanceForm.date} onChange={(e) => setAttendanceForm({ ...attendanceForm, date: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <select value={attendanceForm.status} onChange={(e) => setAttendanceForm({ ...attendanceForm, status: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="Present">Present</option>
                                        <option value="Absent">Absent</option>
                                        <option value="Half Day">Half Day</option>
                                        <option value="Late">Late</option>
                                    </select>
                                    <div className="flex space-x-3">
                                        <button onClick={handleAddAttendance} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Mark</button>
                                        <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showAdminPasswordManagement && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Employee Password Management</h3>
                                
                                {passwordManagementMessage && (
                                    <div className={`mb-6 p-4 rounded-lg ${
                                        passwordManagementMessage.includes('successfully') || passwordManagementMessage.includes('reset to')
                                            ? 'bg-green-100 border border-green-400 text-green-700'
                                            : 'bg-red-100 border border-red-400 text-red-700'
                                    }`}>
                                        {passwordManagementMessage}
                                    </div>
                                )}

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Reset Password Section */}
                                    <div className="bg-orange-50 p-6 rounded-lg border border-orange-200">
                                        <h4 className="text-xl font-semibold mb-4 text-orange-800">Quick Password Reset</h4>
                                        <p className="text-sm text-gray-600 mb-4">Reset employee password to default "employee123"</p>
                                        
                                        <div className="space-y-4">
                                            <div className="max-h-80 overflow-y-auto">
                                                <table className="w-full">
                                                    <thead className="bg-orange-100 sticky top-0">
                                                        <tr>
                                                            <th className="px-4 py-2 text-left text-sm font-medium">Employee</th>
                                                            <th className="px-4 py-2 text-center text-sm font-medium">Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-orange-200">
                                                        {employees.map(emp => (
                                                            <tr key={emp.id}>
                                                                <td className="px-4 py-3">
                                                                    <div className="flex items-center space-x-3">
                                                                        {emp.profile_pic ? (
                                                                            <img src={emp.profile_pic} alt={emp.name} className="w-8 h-8 rounded-full object-cover" onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(emp.name) + '&background=7c3aed&color=fff'} />
                                                                        ) : (
                                                                            <div className="w-8 h-8 rounded-full bg-brand-purple text-white flex items-center justify-center font-bold text-sm">
                                                                                {emp.name.charAt(0).toUpperCase()}
                                                                            </div>
                                                                        )}
                                                                        <div>
                                                                            <p className="font-medium text-sm">{emp.name}</p>
                                                                            <p className="text-xs text-gray-500">{emp.position}</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td className="px-4 py-3 text-center">
                                                                    <button
                                                                        onClick={() => handleAdminResetEmployeePassword(emp.id)}
                                                                        disabled={loading}
                                                                        className="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm disabled:bg-gray-300"
                                                                    >
                                                                        Reset
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                                {employees.length === 0 && <p className="text-center py-4 text-gray-500">No employees found</p>}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Custom Password Section */}
                                    <div className="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                        <h4 className="text-xl font-semibold mb-4 text-blue-800">Set Custom Password</h4>
                                        <p className="text-sm text-gray-600 mb-4">Set a specific password for an employee</p>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Select Employee</label>
                                                <select 
                                                    value={selectedEmployeeForPassword || ''} 
                                                    onChange={(e) => setSelectedEmployeeForPassword(e.target.value ? parseInt(e.target.value) : null)}
                                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                >
                                                    <option value="">Choose Employee</option>
                                                    {employees.map(emp => (
                                                        <option key={emp.id} value={emp.id}>{emp.name} - {emp.position}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium mb-2">New Password</label>
                                                <input 
                                                    type="password" 
                                                    placeholder="Enter new password (min 6 characters)"
                                                    value={adminPasswordForm.newPassword} 
                                                    onChange={(e) => setAdminPasswordForm({ ...adminPasswordForm, newPassword: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                    minLength="6"
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Confirm New Password</label>
                                                <input 
                                                    type="password" 
                                                    placeholder="Confirm new password"
                                                    value={adminPasswordForm.confirmPassword} 
                                                    onChange={(e) => setAdminPasswordForm({ ...adminPasswordForm, confirmPassword: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                    minLength="6"
                                                />
                                            </div>
                                            
                                            <button 
                                                onClick={handleAdminChangeEmployeePassword}
                                                disabled={loading || !selectedEmployeeForPassword || !adminPasswordForm.newPassword || !adminPasswordForm.confirmPassword}
                                                className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-300"
                                            >
                                                {loading ? 'Updating...' : 'Update Password'}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Security Notice */}
                                <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <h5 className="font-semibold text-yellow-800 mb-2"> Security Notice</h5>
                                    <div className="text-sm text-yellow-700 space-y-1">
                                        <p> Employees can login using their email address and the password you set</p>
                                        <p> Default reset password is "employee123"</p>
                                        <p> Consider informing employees when their passwords are changed</p>
                                        <p> Encourage employees to use secure passwords when possible</p>
                                    </div>
                                </div>

                                <div className="flex justify-end mt-8">
                                    <button 
                                        onClick={closeAdminPasswordManagement}
                                        className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-semibold"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showSettings && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-3xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Company Settings</h3>
                                
                                <div className="space-y-6">
                                    <div className="bg-purple-50 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4 text-lg">Company Information</h4>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Company Name</label>
                                                <input 
                                                    type="text" 
                                                    value={settingsForm.company_name || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, company_name: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Address</label>
                                                <textarea 
                                                    value={settingsForm.company_address || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, company_address: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                    rows="3"
                                                    placeholder="Street Address&#10;City, State&#10;Country"
                                                />
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Phone</label>
                                                    <input 
                                                        type="text" 
                                                        value={settingsForm.company_phone || ''} 
                                                        onChange={(e) => setSettingsForm({ ...settingsForm, company_phone: e.target.value })}
                                                        className="w-full px-4 py-2 border rounded-lg"
                                                        placeholder="+234 XXX XXX XXXX"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Email</label>
                                                    <input 
                                                        type="email" 
                                                        value={settingsForm.company_email || ''} 
                                                        onChange={(e) => setSettingsForm({ ...settingsForm, company_email: e.target.value })}
                                                        className="w-full px-4 py-2 border rounded-lg"
                                                        placeholder="hr@company.com"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-orange-50 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4 text-lg">Logo & Branding</h4>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Logo URL</label>
                                                <input 
                                                    type="text" 
                                                    value={settingsForm.logo_url || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, logo_url: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                    placeholder="https://yoursite.com/logo.png"
                                                />
                                                <p className="text-xs text-gray-600 mt-2">Tip: Upload your logo to your GitHub repository, then use the raw URL</p>
                                                <p className="text-xs text-gray-500">Example: https://raw.githubusercontent.com/username/repo/main/logo.png</p>
                                            </div>
                                            {settingsForm.logo_url && (
                                                <div className="mt-3">
                                                    <p className="text-sm font-medium mb-2">Logo Preview:</p>
                                                    <img src={settingsForm.logo_url} alt="Logo" className="h-20 border rounded object-contain bg-white p-2" onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'block';
                                                    }} />
                                                    <p className="text-red-500 text-sm mt-2" style={{display: 'none'}}>Failed to load logo. Please check the URL.</p>
                                                </div>
                                            )}
                                            
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Digital Signature/Stamp URL</label>
                                                <input 
                                                    type="text" 
                                                    value={settingsForm.digital_signature_url || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, digital_signature_url: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                    placeholder="https://yoursite.com/signature.png"
                                                />
                                                <p className="text-xs text-gray-600 mt-2">Add a digital signature or company stamp to appear on all payslips</p>
                                                <p className="text-xs text-gray-500">Recommended size: 200x60 pixels (transparent PNG)</p>
                                            </div>
                                            {settingsForm.digital_signature_url && (
                                                <div className="mt-3">
                                                    <p className="text-sm font-medium mb-2">Signature Preview:</p>
                                                    <img src={settingsForm.digital_signature_url} alt="Signature" className="h-12 border rounded object-contain bg-white p-2" onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'block';
                                                    }} />
                                                    <p className="text-red-500 text-sm mt-2" style={{display: 'none'}}>Failed to load signature. Please check the URL.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4 text-lg">Payslip Footer</h4>
                                        <textarea 
                                            value={settingsForm.payslip_footer || ''} 
                                            onChange={(e) => setSettingsForm({ ...settingsForm, payslip_footer: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                            rows="2"
                                            placeholder="This is a computer-generated payslip and does not require a signature."
                                        />
                                    </div>
                                </div>

                                <div className="flex space-x-3 mt-8">
                                    <button onClick={saveSettings} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-semibold">
                                        Save Settings
                                    </button>
                                    <button onClick={() => setShowSettings(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-3 rounded-lg font-semibold">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showChangePassword && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Change Password</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Current Password</label>
                                        <input 
                                            type="password" 
                                            value={passwordForm.currentPassword} 
                                            onChange={(e) => setPasswordForm({ ...passwordForm, currentPassword: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">New Password</label>
                                        <input 
                                            type="password" 
                                            value={passwordForm.newPassword} 
                                            onChange={(e) => setPasswordForm({ ...passwordForm, newPassword: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Confirm New Password</label>
                                        <input 
                                            type="password" 
                                            value={passwordForm.confirmPassword} 
                                            onChange={(e) => setPasswordForm({ ...passwordForm, confirmPassword: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div className="flex space-x-3 mt-6">
                                        <button onClick={handleChangePassword} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">
                                            Change Password
                                        </button>
                                        <button onClick={() => setShowChangePassword(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>







