<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>JulineMart HR System</title>
    
    <!-- PWA Primary Meta Tags -->
    <meta name="title" content="JulineMart HR System">
    <meta name="description" content="HR Management System for JulineMart - Manage employees, payroll, leave and attendance">
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#7c3aed">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JulineMart HR">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="JulineMart HR">
    
    <!-- Manifest - MUST be in root directory -->
    <link rel="manifest" href="/assets/manifest-Dtax_tim.json">
    
    <!-- Favicons and Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/icon-192x192-HO9SbQzC.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/icon-512x512-D70uCe3S.png">
    <link rel="shortcut icon" href="/assets/icon-192x192-HO9SbQzC.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/icon-192x192-HO9SbQzC.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icon-192x192-HO9SbQzC.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icon-192x192-HO9SbQzC.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/assets/icon-192x192-HO9SbQzC.png">
    
    <!-- iOS Splash Screen -->
    <link rel="apple-touch-startup-image" href="/assets/icon-512x512-D70uCe3S.png">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#7c3aed">
    <meta name="msapplication-TileImage" content="/icons/icon-192x192.png">
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-purple': '#7c3aed',
                        'brand-orange': '#f97316',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="root"></div>
 <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                        
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('ðŸ”„ Service Worker update found');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('âœ¨ New version available - please refresh');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('âŒ Service Worker registration failed:', error);
                    });
            });
        } else {
            console.warn('âš ï¸ Service Workers not supported');
        }

        // PWA Install Prompt
        let deferredPrompt;
        let installButton;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('ðŸ“± PWA Install Available!');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install banner for Android users
            showInstallPrompt();
        });

        window.addEventListener('appinstalled', () => {
            console.log('âœ… PWA Installed Successfully!');
            deferredPrompt = null;
            hideInstallPrompt();
        });

        function showInstallPrompt() {
            // Don't show if already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                return;
            }
            
            // Create install banner
            const installBanner = document.createElement('div');
            installBanner.id = 'pwa-install-banner';
            installBanner.innerHTML = `
                <div style="
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    right: 20px;
                    z-index: 9999;
                    background: linear-gradient(135deg, #7c3aed, #f97316);
                    color: white;
                    padding: 16px;
                    border-radius: 12px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
                    animation: slideUp 0.5s ease-out;
                    font-family: system-ui, -apple-system, sans-serif;
                ">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="
                            width: 48px;
                            height: 48px;
                            background: rgba(255,255,255,0.2);
                            border-radius: 12px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 24px;
                        ">ðŸ“±</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 16px; margin-bottom: 4px;">
                                Install JulineMart HR App
                            </div>
                            <div style="font-size: 14px; opacity: 0.9;">
                                Get the full app experience with offline access and home screen shortcut
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button id="pwa-install-btn" style="
                                background: rgba(255,255,255,0.9);
                                color: #7c3aed;
                                border: none;
                                padding: 8px 16px;
                                border-radius: 8px;
                                font-weight: bold;
                                cursor: pointer;
                                font-size: 14px;
                            ">Install</button>
                            <button id="pwa-dismiss-btn" style="
                                background: transparent;
                                color: white;
                                border: 1px solid rgba(255,255,255,0.5);
                                padding: 8px 12px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                            ">Later</button>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes slideUp {
                        from { transform: translateY(100%); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    @media (max-width: 480px) {
                        #pwa-install-banner > div {
                            flex-direction: column !important;
                            text-align: center !important;
                        }
                        #pwa-install-banner button {
                            flex: 1 !important;
                        }
                    }
                </style>
            `;
            
            document.body.appendChild(installBanner);
            
            // Add event listeners
            document.getElementById('pwa-install-btn').addEventListener('click', installApp);
            document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
                hideInstallPrompt();
                // Don't show again for 24 hours
                localStorage.setItem('pwa-dismissed', Date.now());
            });
            
            // Auto-hide after 30 seconds
            setTimeout(() => {
                if (document.getElementById('pwa-install-banner')) {
                    hideInstallPrompt();
                }
            }, 30000);
        }
        
        function hideInstallPrompt() {
            const banner = document.getElementById('pwa-install-banner');
            if (banner) {
                banner.style.animation = 'slideDown 0.3s ease-in forwards';
                setTimeout(() => banner.remove(), 300);
            }
        }
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('User choice:', choiceResult.outcome);
                    deferredPrompt = null;
                    hideInstallPrompt();
                });
            }
        }
        
        // Check if we should show the prompt
        window.addEventListener('load', () => {
            // Don't show if dismissed recently (within 24 hours)
            const dismissed = localStorage.getItem('pwa-dismissed');
            if (dismissed && (Date.now() - parseInt(dismissed)) < 24 * 60 * 60 * 1000) {
                return;
            }
            
            // Don't show if already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('ðŸš€ Running as installed PWA');
                return;
            }
            
            // Show prompt after a short delay if we have the event
            setTimeout(() => {
                if (deferredPrompt) {
                    showInstallPrompt();
                }
            }, 3000);
        });
        
        // Add CSS for slideDown animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translateY(0); opacity: 1; }
                to { transform: translateY(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- YOUR EXISTING REACT CODE STAYS HERE - DON'T TOUCH IT -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        const SUPABASE_URL = 'https://uttpqcovbuxaheguqvyo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0dHBxY292YnV4YWhlZ3VxdnlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNjIwMTUsImV4cCI6MjA3NDgzODAxNX0.DSoOumPSSZKfs4e308-vTP6BItl-Bx8SWUHqz6ALKa0';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const Icons = {
            Users: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Dollar: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Calendar: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Clock: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Chart: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
            Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            Edit: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Trash: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            Download: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            Lock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>,
            Logout: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
            Settings: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        };

        const generatePDFPayslip = async (payroll, employee, settings, event = null) => {
            // Show loading state
            const button = event ? event.currentTarget : null;
            const originalText = button ? button.innerHTML : '';
            if (button) {
                button.disabled = true;
                button.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Generating...';
            }
            
            // Ensure jsPDF is fully loaded before proceeding
            if (!window.jspdf || !window.jspdf.jsPDF) {
                console.error('jsPDF not loaded yet, retrying...');
                await new Promise(resolve => setTimeout(resolve, 200));
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    alert('PDF library is still loading. Please try again in a moment.');
                    if (button) {
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }
                    return;
                }
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
            
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            let yPos = 20;

            doc.setFillColor(245, 247, 250);
            doc.rect(0, 0, pageWidth, 45, 'F');
            
            if (settings.logo_url) {
                try {
                    doc.addImage(settings.logo_url, 'PNG', margin, 10, 30, 30);
                } catch (e) {
                    console.log('Logo loading skipped');
                }
            }

            doc.setTextColor(44, 62, 80);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text(settings.company_name || 'JulineMart', pageWidth - margin, 18, { align: 'right' });
            
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(100, 100, 100);
            const addressLines = (settings.company_address || '').split('\n');
            addressLines.forEach((line, i) => {
                doc.text(line, pageWidth - margin, 26 + (i * 4), { align: 'right' });
            });

            doc.setTextColor(44, 62, 80);
            yPos = 58;
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('PAYSLIP', pageWidth / 2, yPos, { align: 'center' });
            
            yPos += 3;
            doc.setLineWidth(1.5);
            doc.setDrawColor(52, 152, 219);
            doc.line(pageWidth / 2 - 20, yPos, pageWidth / 2 + 20, yPos);

            yPos += 12;

            doc.setFillColor(245, 247, 250);
            doc.rect(margin, yPos, pageWidth - 2 * margin, 40, 'F');
            doc.setDrawColor(200, 200, 200);
            doc.rect(margin, yPos, pageWidth - 2 * margin, 40);

            yPos += 8;
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(52, 73, 94);

            const labelX = margin + 5;
            const valueX = margin + 50;
            
            doc.text('Employee Name:', labelX, yPos);
            doc.setFont(undefined, 'normal');
            doc.text(payroll.employee_name, valueX, yPos);

            doc.setFont(undefined, 'bold');
            doc.text('Employee Code:', labelX, yPos + 7);
            doc.setFont(undefined, 'normal');
            doc.text(employee.employee_code || 'N/A', valueX, yPos + 7);

            doc.setFont(undefined, 'bold');
            doc.text('Designation:', labelX, yPos + 14);
            doc.setFont(undefined, 'normal');
            doc.text(employee.position || 'N/A', valueX, yPos + 14);

            doc.setFont(undefined, 'bold');
            doc.text('Department:', labelX, yPos + 21);
            doc.setFont(undefined, 'normal');
            doc.text(employee.department || 'N/A', valueX, yPos + 21);

            const rightLabelX = pageWidth / 2 + 10;
            const rightValueX = pageWidth / 2 + 50;
            
            doc.setFont(undefined, 'bold');
            doc.text('Payslip No:', rightLabelX, yPos);
            doc.setFont(undefined, 'normal');
            doc.text(payroll.payslip_no || 'N/A', rightValueX, yPos);

            doc.setFont(undefined, 'bold');
            doc.text('Pay Period:', rightLabelX, yPos + 7);
            doc.setFont(undefined, 'normal');
            const payPeriod = payroll.pay_period_start && payroll.pay_period_end 
                ? `${payroll.pay_period_start} to ${payroll.pay_period_end}`
                : `${payroll.month} ${payroll.year}`;
            doc.text(payPeriod, rightValueX, yPos + 7);

            doc.setFont(undefined, 'bold');
            doc.text('Working Days:', rightLabelX, yPos + 14);
            doc.setFont(undefined, 'normal');
            doc.text(String(payroll.working_days || 30), rightValueX, yPos + 14);

            doc.setFont(undefined, 'bold');
            doc.text('Payment Mode:', rightLabelX, yPos + 21);
            doc.setFont(undefined, 'normal');
            doc.text(employee.payment_mode || 'Bank Transfer', rightValueX, yPos + 21);

            yPos += 35;

            if (employee.bank_name) {
                doc.setFillColor(250, 250, 250);
                doc.rect(margin, yPos, pageWidth - 2 * margin, 12, 'F');
                doc.setDrawColor(200, 200, 200);
                doc.rect(margin, yPos, pageWidth - 2 * margin, 12);
                
                yPos += 8;
                doc.setFont(undefined, 'bold');
                doc.setFontSize(9);
                doc.text('Bank Details:', margin + 5, yPos);
                doc.setFont(undefined, 'normal');
                doc.text(`${employee.bank_name} - ${employee.bank_account || 'N/A'}`, margin + 35, yPos);
                yPos += 8;
            } else {
                yPos += 5;
            }

            const tableTop = yPos;
            const colWidth = (pageWidth - 2 * margin) / 2 - 2;

            doc.setFillColor(52, 152, 219);
            doc.rect(margin, tableTop, colWidth, 10, 'F');
            doc.rect(pageWidth / 2 + 1, tableTop, colWidth, 10, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, 'bold');
            doc.setFontSize(11);
            doc.text('EARNINGS', margin + colWidth / 2, tableTop + 7, { align: 'center' });
            doc.text('DEDUCTIONS', pageWidth / 2 + 1 + colWidth / 2, tableTop + 7, { align: 'center' });

            yPos = tableTop + 15;

            doc.setTextColor(52, 73, 94);
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);

            const earningsData = [];
            earningsData.push(['Basic Salary', parseFloat(payroll.basic_salary || 0).toLocaleString()]);
            
            if (payroll.overtime_pay > 0) earningsData.push(['Overtime Pay', parseFloat(payroll.overtime_pay).toLocaleString()]);
            if (payroll.holiday_pay > 0) earningsData.push(['Holiday Pay', parseFloat(payroll.holiday_pay).toLocaleString()]);
            if (payroll.bonus > 0) earningsData.push(['Bonus/Incentive', parseFloat(payroll.bonus).toLocaleString()]);
            if (payroll.allowances > 0) earningsData.push(['Allowances', parseFloat(payroll.allowances).toLocaleString()]);

            const deductionsData = [];
            if (payroll.tax > 0) deductionsData.push(['Tax (PAYE)', parseFloat(payroll.tax).toLocaleString()]);
            if (payroll.pension > 0) deductionsData.push(['Pension', parseFloat(payroll.pension).toLocaleString()]);
            if (payroll.nhf > 0) deductionsData.push(['NHF', parseFloat(payroll.nhf).toLocaleString()]);
            if (payroll.loan_deduction > 0) deductionsData.push(['Loan Repayment', parseFloat(payroll.loan_deduction).toLocaleString()]);
            if (payroll.other_deductions > 0) deductionsData.push(['Other Deductions', parseFloat(payroll.other_deductions).toLocaleString()]);

            const maxRows = Math.max(earningsData.length, deductionsData.length);

            for (let i = 0; i < maxRows; i++) {
                if (i < earningsData.length) {
                    doc.setFont(undefined, 'normal');
                    doc.text(earningsData[i][0], margin + 5, yPos);
                    doc.text('NGN ' + earningsData[i][1], margin + colWidth - 5, yPos, { align: 'right' });
                }
                
                if (i < deductionsData.length) {
                    doc.text(deductionsData[i][0], pageWidth / 2 + 6, yPos);
                    doc.text('NGN ' + deductionsData[i][1], pageWidth / 2 + colWidth - 4, yPos, { align: 'right' });
                }
                
                yPos += 7;
            }

            yPos += 3;

            doc.setDrawColor(200, 200, 200);
            doc.line(margin, yPos, margin + colWidth, yPos);
            doc.line(pageWidth / 2 + 1, yPos, pageWidth / 2 + 1 + colWidth, yPos);
            
            yPos += 8;
            doc.setFont(undefined, 'bold');
            doc.setFontSize(11);
            doc.text('Total Earnings', margin + 5, yPos);
            doc.text('NGN ' + parseFloat(payroll.gross_salary || 0).toLocaleString(), margin + colWidth - 5, yPos, { align: 'right' });

            const totalDeductions = parseFloat(payroll.tax || 0) + parseFloat(payroll.pension || 0) + 
                                   parseFloat(payroll.nhf || 0) + parseFloat(payroll.loan_deduction || 0) + 
                                   parseFloat(payroll.other_deductions || 0);
            
            doc.text('Total Deductions', pageWidth / 2 + 6, yPos);
            doc.text('NGN ' + totalDeductions.toLocaleString(), pageWidth / 2 + colWidth - 4, yPos, { align: 'right' });

            yPos += 12;

// Draw a line separator instead of colored box
doc.setDrawColor(46, 204, 113);
doc.setLineWidth(0.5);
doc.line(margin, yPos - 2, pageWidth - margin, yPos - 2);

doc.setTextColor(46, 204, 113);
doc.setFontSize(14);
doc.setFont(undefined, 'bold');
doc.text('NET PAY', margin + 5, yPos + 5);
doc.text('NGN ' + parseFloat(payroll.net_salary || 0).toLocaleString(), pageWidth - margin - 5, yPos + 5, { align: 'right' });

            if (payroll.comments) {
                yPos += 20;
                doc.setTextColor(52, 73, 94);
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Comments:', margin, yPos);
                doc.setFont(undefined, 'normal');
                const splitComments = doc.splitTextToSize(payroll.comments, pageWidth - 2 * margin - 10);
                doc.text(splitComments, margin + 5, yPos + 5);
            }

            const footerY = doc.internal.pageSize.height - 35;
            doc.setTextColor(120, 120, 120);
            doc.setFontSize(8);
            doc.setFont(undefined, 'italic');
            const footerText = settings.payslip_footer || 'This is a computer-generated payslip and does not require a signature.';
            const splitFooter = doc.splitTextToSize(footerText, pageWidth - 40);
            doc.text(splitFooter, pageWidth / 2, footerY, { align: 'center' });
            
            doc.setFont(undefined, 'normal');
            
            // Add digital signature/stamp if available
            if (settings.digital_signature_url) {
                try {
                    // Add the signature image - moved higher for better visibility
                    const signatureY = footerY - 18;
                    doc.addImage(settings.digital_signature_url, 'PNG', pageWidth - margin - 60, signatureY, 50, 15);
                } catch (e) {
                    console.log('Digital signature loading skipped:', e);
                    // Fallback: draw signature line if image fails
                    doc.line(pageWidth - margin - 50, footerY - 8, pageWidth - margin - 5, footerY - 8);
                }
            } else {
                // Default signature line - moved higher
                doc.line(pageWidth - margin - 50, footerY - 8, pageWidth - margin - 5, footerY - 8);
            }
            
            doc.setFontSize(9);
            doc.text('Authorized Signature', pageWidth - margin, footerY - 3, { align: 'right' });

            doc.save(`Payslip_${payroll.employee_name}_${payroll.month}_${payroll.year}.pdf`);
            
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Reset button state
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalText;
                }
            }
        };

        const BlogBannerCarousel = ({ blogBanners }) => {
            const [currentSlide, setCurrentSlide] = useState(0);

            useEffect(() => {
                if (blogBanners.length > 1) {
                    const interval = setInterval(() => {
                        setCurrentSlide(prev => (prev + 1) % blogBanners.length);
                    }, 5000);
                    return () => clearInterval(interval);
                }
            }, [blogBanners.length]);

            if (blogBanners.length === 0) {
                return (
                    <div className="bg-gradient-to-r from-purple-100 to-orange-100 p-6 rounded-lg text-center">
                        <p className="text-gray-500">ðŸ“° No blog announcements available</p>
                    </div>
                );
            }

            const banner = blogBanners[currentSlide];

            return (
                <div className="relative bg-white rounded-lg shadow-lg border overflow-hidden">
                    <a
                        href={banner.link_url}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="block hover:opacity-95 transition-opacity duration-200"
                    >
                        <div className="relative h-48 bg-gradient-to-r from-purple-500 to-orange-500">
                            <img
                                src={banner.image_url}
                                alt={banner.title}
                                className="w-full h-full object-cover"
                                style={{display: 'block'}}
                                onLoad={(e) => {
                                    e.target.style.display = 'block';
                                    const fallback = e.target.nextElementSibling;
                                    if (fallback) {
                                        fallback.style.display = 'none';
                                    }
                                }}
                                onError={(e) => {
                                    e.target.style.display = 'none';
                                    const fallback = e.target.nextElementSibling;
                                    if (fallback) {
                                        fallback.style.display = 'flex';
                                    }
                                }}
                            />
                            <div className="hidden absolute inset-0 bg-gradient-to-r from-purple-500 to-orange-500 items-center justify-center">
                                <div className="text-white text-center p-8">
                                    <div className="text-6xl mb-4">ðŸ“°</div>
                                    <h3 className="text-2xl font-bold mb-2">{banner.title}</h3>
                                    <p className="text-sm opacity-90">Image failed to load</p>
                                </div>
                            </div>
                            
                            <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6">
                                <h3 className="text-white text-xl font-bold mb-2">{banner.title}</h3>
                                {banner.description && (
                                    <p className="text-white/90 text-sm">{banner.description}</p>
                                )}
                                <div className="flex items-center mt-2 text-white/80 text-sm">
                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                    </svg>
                                    Click to read more
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    {blogBanners.length > 1 && (
                        <div className="absolute top-4 right-4 flex space-x-1">
                            {blogBanners.map((_, index) => (
                                <button
                                    key={index}
                                    onClick={() => setCurrentSlide(index)}
                                    className={`w-2 h-2 rounded-full transition-all duration-200 ${
                                        index === currentSlide ? 'bg-white' : 'bg-white/50'
                                    }`}
                                />
                            ))}
                        </div>
                    )}
                    
                    {blogBanners.length > 1 && (
                        <>
                            <button
                                onClick={() => setCurrentSlide(prev => prev === 0 ? blogBanners.length - 1 : prev - 1)}
                                className="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white p-2 rounded-full transition-colors duration-200"
                            >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <button
                                onClick={() => setCurrentSlide(prev => (prev + 1) % blogBanners.length)}
                                className="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white p-2 rounded-full transition-colors duration-200"
                            >
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </>
                    )}
                </div>
            );
        };

        function App() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userRole, setUserRole] = useState('');
            const [currentUserId, setCurrentUserId] = useState(null);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [loginError, setLoginError] = useState('');
            const [activeTab, setActiveTab] = useState('dashboard');
            const [employees, setEmployees] = useState([]);
            const [payrolls, setPayrolls] = useState([]);
            const [leaveRequests, setLeaveRequests] = useState([]);
            const [attendance, setAttendance] = useState([]);
            const [resignations, setResignations] = useState([]);
            const [archivedEmployees, setArchivedEmployees] = useState([]);
            const [performanceRecords, setPerformanceRecords] = useState([]);
            const [settings, setSettings] = useState({});
            const [loading, setLoading] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editingItem, setEditingItem] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [showChangePassword, setShowChangePassword] = useState(false);
            const [showResetPassword, setShowResetPassword] = useState(false);
            const [resetPasswordForm, setResetPasswordForm] = useState({ email: '' });
            const [resetPasswordMessage, setResetPasswordMessage] = useState('');
            const [showAdminPasswordManagement, setShowAdminPasswordManagement] = useState(false);
            const [selectedEmployeeForPassword, setSelectedEmployeeForPassword] = useState(null);
            const [adminPasswordForm, setAdminPasswordForm] = useState({ newPassword: '', confirmPassword: '' });
            const [passwordManagementMessage, setPasswordManagementMessage] = useState('');
            const [showProfileDropdown, setShowProfileDropdown] = useState(false);
            const [blogBanners, setBlogBanners] = useState([]);
            const [showBlogBannerModal, setShowBlogBannerModal] = useState(false);
            const [blogBannerForm, setBlogBannerForm] = useState({
                title: '', image_url: '', link_url: '', description: ''
            });
            const [editingBanner, setEditingBanner] = useState(null);

            const [employeeForm, setEmployeeForm] = useState({
    name: '', email: '', position: '', department: '', salary: '', joinDate: '', leaveBalance: 20,
    employeeCode: '', bankName: '', bankAccount: '', paymentMode: 'Bank', phone: '', profilePic: ''
});
            const [payrollForm, setPayrollForm] = useState({
                employeeId: '', month: '', year: '', basicSalary: '', 
                allowances: 0, overtimePay: 0, holidayPay: 0, bonus: 0,
                tax: 0, pension: 0, nhf: 0, loanDeduction: 0, otherDeductions: 0,
                taxRate: 10, workingDays: 30, payPeriodStart: '', payPeriodEnd: '', comments: ''
            });
            const [leaveForm, setLeaveForm] = useState({
                employeeId: '', startDate: '', endDate: '', reason: '', type: 'Annual'
            });
            const [attendanceForm, setAttendanceForm] = useState({
                employeeId: '', date: '', status: 'Present'
            });
            const [resignationForm, setResignationForm] = useState({
                employeeId: '', resignationDate: '', lastWorkingDate: '', reason: '', comments: ''
            });
            const [performanceForm, setPerformanceForm] = useState({
                employeeId: '', date: '', overall_rating: 5, quality_rating: 5, productivity_rating: 5, 
                teamwork_rating: 5, communication_rating: 5, punctuality_rating: 5, goals_met: 'Yes',
                notes: '', period_type: 'Weekly'
            });
            const [settingsForm, setSettingsForm] = useState({});
            const [passwordForm, setPasswordForm] = useState({
                currentPassword: '', newPassword: '', confirmPassword: ''
            });

            useEffect(() => {
                const loggedIn = localStorage.getItem('julinemart_logged_in');
                const role = localStorage.getItem('julinemart_user_role');
                const userId = localStorage.getItem('julinemart_user_id');
                if (loggedIn === 'true') {
                    setIsLoggedIn(true);
                    setUserRole(role || 'admin');
                    setCurrentUserId(userId ? parseInt(userId) : null);
                }
            }, []);

            useEffect(() => {
                if (isLoggedIn && userRole && currentUserId) {
                    loadAllData();
                    loadSettings();
                    loadBlogBanners();
                }
            }, [isLoggedIn, userRole, currentUserId]);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (showProfileDropdown && !event.target.closest('.profile-dropdown-container')) {
                        setShowProfileDropdown(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [showProfileDropdown]);

            const loadBlogBanners = async () => {
                try {
                    const { data } = await supabase.from('blog_banners').select('*').order('id', { ascending: false });
                    if (data) {
                        setBlogBanners(data);
                    }
                } catch (error) {
                    console.error('Error loading blog banners:', error);
                }
            };

            const handleAddBlogBanner = async () => {
                if (!blogBannerForm.title || !blogBannerForm.image_url || !blogBannerForm.link_url) {
                    alert('Please fill in all required fields');
                    return;
                }

                // Clean and validate image URL
                const cleanImageUrl = blogBannerForm.image_url.trim();
                const cleanLinkUrl = blogBannerForm.link_url.trim();
                
                if (!cleanImageUrl.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp|svg)(\?.*)?$/i)) {
                    if (!confirm('The image URL doesn\'t appear to be a direct link to an image file. This might cause display issues. Continue anyway?')) {
                        return;
                    }
                }

                if (!cleanLinkUrl.match(/^https?:\/\/.+/i)) {
                    alert('Please enter a valid link URL starting with http:// or https://');
                    return;
                }

                setLoading(true);
                try {
                    const bannerData = {
                        title: blogBannerForm.title.trim(),
                        image_url: cleanImageUrl,
                        link_url: cleanLinkUrl,
                        description: blogBannerForm.description.trim() || '',
                        created_at: new Date().toISOString()
                    };

                    let result;
                    if (editingBanner) {
                        result = await supabase.from('blog_banners').update(bannerData).eq('id', editingBanner.id);
                    } else {
                        result = await supabase.from('blog_banners').insert([bannerData]);
                    }

                    if (result.error) throw result.error;

                    alert('Blog banner saved successfully!');
                    await loadBlogBanners();
                    closeBlogBannerModal();
                } catch (error) {
                    console.error('Error saving blog banner:', error);
                    alert('Error saving blog banner: ' + error.message);
                }
                setLoading(false);
            };

            const handleDeleteBlogBanner = async (id) => {
                if (confirm('Are you sure you want to delete this blog banner?')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('blog_banners').delete().eq('id', id);
                        if (error) throw error;
                        alert('Blog banner deleted successfully');
                        await loadBlogBanners();
                    } catch (error) {
                        alert('Error deleting blog banner: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const openBlogBannerModal = (banner = null) => {
                setEditingBanner(banner);
                if (banner) {
                    setBlogBannerForm({
                        title: banner.title,
                        image_url: banner.image_url,
                        link_url: banner.link_url,
                        description: banner.description || ''
                    });
                } else {
                    setBlogBannerForm({
                        title: '', image_url: '', link_url: '', description: ''
                    });
                }
                setShowBlogBannerModal(true);
            };

            const closeBlogBannerModal = () => {
                setShowBlogBannerModal(false);
                setEditingBanner(null);
                setBlogBannerForm({
                    title: '', image_url: '', link_url: '', description: ''
                });
            };

            const loadSettings = async () => {
                try {
                    const { data } = await supabase.from('company_settings').select('*').eq('id', 1).single();
                    if (data) {
                        setSettings(data);
                        setSettingsForm(data);
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
            };

            const saveSettings = async () => {
                setLoading(true);
                try {
                    const { error } = await supabase
                        .from('company_settings')
                        .upsert({ id: 1, ...settingsForm, updated_at: new Date().toISOString() });
                    
                    if (error) throw error;
                    await loadSettings();
                    alert('Settings saved successfully!');
                } catch (error) {
                    alert('Error saving settings: ' + error.message);
                }
                setLoading(false);
            };

            const handleLogin = async () => {
                setLoginError('');
                setLoading(true);

                try {
                    const { data: adminData } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('username', loginForm.username)
                        .eq('password', loginForm.password)
                        .single();

                    if (adminData) {
                        setIsLoggedIn(true);
                        setUserRole('admin');
                        localStorage.setItem('julinemart_logged_in', 'true');
                        localStorage.setItem('julinemart_user_role', 'admin');
                        localStorage.setItem('julinemart_user_id', adminData.id);
                        setCurrentUserId(adminData.id);
                        setLoginForm({ username: '', password: '' });
                    } else {
    const { data: empData } = await supabase
        .from('employees')
        .select('*')
        .eq('email', loginForm.username)
        .single();

    if (empData) {
        // Check if password matches or use default if no password set
        const employeePassword = empData.password || 'employee123';
        if (employeePassword === loginForm.password) {
            setIsLoggedIn(true);
            setUserRole('employee');
            setCurrentUserId(empData.id);
            localStorage.setItem('julinemart_logged_in', 'true');
            localStorage.setItem('julinemart_user_role', 'employee');
            localStorage.setItem('julinemart_user_id', empData.id);
            setLoginForm({ username: '', password: '' });
        } else {
            setLoginError('Invalid email or password');
        }
    } else {
        setLoginError('Invalid email or password');
    }
}
                } catch (err) {
                    setLoginError('Login failed. Please check your credentials.');
                }

                setLoading(false);
            };

            const handleChangePassword = async () => {
                if (passwordForm.newPassword !== passwordForm.confirmPassword) {
                    alert('New passwords do not match!');
                    return;
                }

                setLoading(true);
                try {
                    const { data } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('password', passwordForm.currentPassword)
                        .single();

                    if (!data) {
                        alert('Current password is incorrect!');
                        setLoading(false);
                        return;
                    }

                    await supabase
                        .from('admin_users')
                        .update({ password: passwordForm.newPassword })
                        .eq('id', data.id);

                    alert('Password changed successfully!');
                    setShowChangePassword(false);
                    setPasswordForm({ currentPassword: '', newPassword: '', confirmPassword: '' });
                } catch (error) {
                    alert('Error changing password: ' + error.message);
                }
                setLoading(false);
            };

            const handleResetPassword = async () => {
                if (!resetPasswordForm.email) {
                    alert('Please enter your email address');
                    return;
                }

                setLoading(true);
                setResetPasswordMessage('');
                
                try {
                    // Check if email exists in admin_users table
                    const { data: adminData } = await supabase
                        .from('admin_users')
                        .select('*')
                        .eq('username', resetPasswordForm.email)
                        .single();

                    if (adminData) {
                        // Generate a temporary password
                        const tempPassword = 'temp' + Math.random().toString(36).substring(2, 8);
                        
                        // Update the password in database
                        await supabase
                            .from('admin_users')
                            .update({ password: tempPassword })
                            .eq('id', adminData.id);
                        
                        setResetPasswordMessage(`Password reset successful! Your temporary password is: ${tempPassword}. Please login and change your password immediately.`);
                    } else {
                        // Check if email exists in employees table
                        const { data: empData } = await supabase
                            .from('employees')
                            .select('*')
                            .eq('email', resetPasswordForm.email)
                            .single();

                        if (empData) {
                            // Reset employee password to default
                            const newPassword = 'employee123';
                            
                            await supabase
                                .from('employees')
                                .update({ password: newPassword })
                                .eq('id', empData.id);
                            
                            setResetPasswordMessage(`Password reset successful! Your password has been reset to: ${newPassword}. Please login and ask your admin to change it.`);
                        } else {
                            setResetPasswordMessage('No account found with this email address.');
                        }
                    }
                } catch (error) {
                    setResetPasswordMessage('Error resetting password. Please try again.');
                    console.error('Reset password error:', error);
                }
                
                setLoading(false);
            };

            const handleAdminResetEmployeePassword = async (employeeId) => {
                if (!employeeId) {
                    alert('Please select an employee');
                    return;
                }

                setLoading(true);
                setPasswordManagementMessage('');
                
                try {
                    const employee = employees.find(e => e.id === employeeId);
                    if (!employee) {
                        throw new Error('Employee not found');
                    }

                    // Reset to default password
                    const defaultPassword = 'employee123';
                    
                    const { error } = await supabase
                        .from('employees')
                        .update({ password: defaultPassword })
                        .eq('id', employeeId);
                    
                    if (error) throw error;
                    
                    setPasswordManagementMessage(`Password for ${employee.name} has been reset to: ${defaultPassword}`);
                } catch (error) {
                    setPasswordManagementMessage('Error resetting password: ' + error.message);
                    console.error('Admin reset password error:', error);
                }
                
                setLoading(false);
            };

            const handleAdminChangeEmployeePassword = async () => {
                if (!selectedEmployeeForPassword) {
                    alert('Please select an employee');
                    return;
                }

                if (!adminPasswordForm.newPassword || adminPasswordForm.newPassword.length < 6) {
                    alert('Password must be at least 6 characters long');
                    return;
                }

                if (adminPasswordForm.newPassword !== adminPasswordForm.confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }

                setLoading(true);
                setPasswordManagementMessage('');
                
                try {
                    const employee = employees.find(e => e.id === selectedEmployeeForPassword);
                    if (!employee) {
                        throw new Error('Employee not found');
                    }
                    
                    const { error } = await supabase
                        .from('employees')
                        .update({ password: adminPasswordForm.newPassword })
                        .eq('id', selectedEmployeeForPassword);
                    
                    if (error) throw error;
                    
                    setPasswordManagementMessage(`Password for ${employee.name} has been updated successfully`);
                    setAdminPasswordForm({ newPassword: '', confirmPassword: '' });
                    setSelectedEmployeeForPassword(null);
                } catch (error) {
                    setPasswordManagementMessage('Error changing password: ' + error.message);
                    console.error('Admin change password error:', error);
                }
                
                setLoading(false);
            };

            const openAdminPasswordManagement = () => {
                setShowAdminPasswordManagement(true);
                setPasswordManagementMessage('');
                setAdminPasswordForm({ newPassword: '', confirmPassword: '' });
                setSelectedEmployeeForPassword(null);
            };

            const closeAdminPasswordManagement = () => {
                setShowAdminPasswordManagement(false);
                setPasswordManagementMessage('');
                setAdminPasswordForm({ newPassword: '', confirmPassword: '' });
                setSelectedEmployeeForPassword(null);
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setUserRole('');
                setCurrentUserId(null);
                localStorage.removeItem('julinemart_logged_in');
                localStorage.removeItem('julinemart_user_role');
                localStorage.removeItem('julinemart_user_id');
                setActiveTab('dashboard');
            };

            const loadAllData = async () => {
                setLoading(true);
                try {
                    if (userRole === 'employee') {
                        const [empData, payData, leaveData, attData, resData, perfData] = await Promise.all([
                            supabase.from('employees').select('*').eq('id', currentUserId).single(),
                            supabase.from('payrolls').select('*').eq('employee_id', currentUserId).order('id', { ascending: false }),
                            supabase.from('leave_requests').select('*').eq('employee_id', currentUserId).order('id', { ascending: false }),
                            supabase.from('attendance').select('*').eq('employee_id', currentUserId).order('date', { ascending: false }),
                            supabase.from('resignations').select('*').eq('employee_id', currentUserId).order('id', { ascending: false }),
                            supabase.from('performance_records').select('*').eq('employee_id', currentUserId).order('date', { ascending: false })
                        ]);

                        if (empData.data) setEmployees([empData.data]);
                        if (payData.data) setPayrolls(payData.data);
                        if (leaveData.data) setLeaveRequests(leaveData.data);
                        if (attData.data) setAttendance(attData.data);
                        if (resData.data) setResignations(resData.data);
                        if (perfData.data) setPerformanceRecords(perfData.data);
                    } else {
                        const [empData, payData, leaveData, attData, resData, archData, perfData] = await Promise.all([
                            supabase.from('employees').select('*').order('id', { ascending: true }),
                            supabase.from('payrolls').select('*').order('id', { ascending: false }),
                            supabase.from('leave_requests').select('*').order('id', { ascending: false }),
                            supabase.from('attendance').select('*').order('date', { ascending: false }),
                            supabase.from('resignations').select('*').order('id', { ascending: false }),
                            supabase.from('archived_employees').select('*').order('archived_at', { ascending: false }),
                            supabase.from('performance_records').select('*').order('date', { ascending: false })
                        ]);

                        if (empData.data) setEmployees(empData.data);
                        if (payData.data) setPayrolls(payData.data);
                        if (leaveData.data) setLeaveRequests(leaveData.data);
                        if (attData.data) setAttendance(attData.data);
                        if (resData.data) setResignations(resData.data);
                        if (archData.data) setArchivedEmployees(archData.data);
                        if (perfData.data) setPerformanceRecords(perfData.data);
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                }
                setLoading(false);
            };

            const openModal = (type, item = null) => {
    setModalType(type);
    setEditingItem(item);
    if (item && type === 'employee') {
        setEmployeeForm({
            name: item.name,
            email: item.email,
            position: item.position,
            department: item.department,
            salary: item.salary,
            joinDate: item.join_date,
            leaveBalance: item.leave_balance,
            employeeCode: item.employee_code || '',
            bankName: item.bank_name || '',
            bankAccount: item.bank_account || '',
            paymentMode: item.payment_mode || 'Bank',
            phone: item.phone || '',
            profilePic: item.profile_pic || ''
        });
    }
    setShowModal(true);
};

            const closeModal = () => {
    setShowModal(false);
    setEditingItem(null);
    setEmployeeForm({ name: '', email: '', position: '', department: '', salary: '', joinDate: '', leaveBalance: 20, employeeCode: '', bankName: '', bankAccount: '', paymentMode: 'Bank', phone: '', profilePic: '' });
    setPayrollForm({ employeeId: '', month: '', year: '', basicSalary: '', allowances: 0, overtimePay: 0, holidayPay: 0, bonus: 0, tax: 0, pension: 0, nhf: 0, loanDeduction: 0, otherDeductions: 0, taxRate: 10, workingDays: 30, payPeriodStart: '', payPeriodEnd: '', comments: '' });
    setLeaveForm({ employeeId: '', startDate: '', endDate: '', reason: '', type: 'Annual' });
    setAttendanceForm({ employeeId: '', date: '', status: 'Present' });
    setResignationForm({ employeeId: '', resignationDate: '', lastWorkingDate: '', reason: '', comments: '' });
    setPerformanceForm({ employeeId: '', date: '', overall_rating: 5, quality_rating: 5, productivity_rating: 5, teamwork_rating: 5, communication_rating: 5, punctuality_rating: 5, goals_met: 'Yes', notes: '', period_type: 'Weekly' });
};
            const handleAddEmployee = async () => {
    // Validate required fields
    if (!employeeForm.name || !employeeForm.email || !employeeForm.position || !employeeForm.salary) {
        alert('Please fill in all required fields: Name, Email, Position, and Salary');
        return;
    }

    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(employeeForm.email)) {
        alert('Please enter a valid email address');
        return;
    }

    setLoading(true);
    try {
        const employeeData = {
            name: employeeForm.name,
            email: employeeForm.email,
            position: employeeForm.position,
            department: employeeForm.department || '',
            salary: parseFloat(employeeForm.salary),
            join_date: employeeForm.joinDate || new Date().toISOString().split('T')[0],
            leave_balance: parseInt(employeeForm.leaveBalance) || 20,
            employee_code: employeeForm.employeeCode || '',
            bank_name: employeeForm.bankName || '',
            bank_account: employeeForm.bankAccount || '',
            payment_mode: employeeForm.paymentMode || 'Bank',
            phone: employeeForm.phone || '',
            profile_pic: employeeForm.profilePic || '',
            password: 'employee123'
        };

        console.log('Attempting to save employee:', employeeData);

        let result;
        if (editingItem) {
            result = await supabase.from('employees').update(employeeData).eq('id', editingItem.id);
        } else {
            result = await supabase.from('employees').insert([employeeData]);
        }

        console.log('Save result:', result);

        if (result.error) {
            throw result.error;
        }

        alert('Employee saved successfully!');
        await loadAllData();
        closeModal();
    } catch (error) {
        console.error('Full error:', error);
        alert('Error saving employee: ' + error.message);
    }
    setLoading(false);
};

            const handleDeleteEmployee = async (id) => {
    if (confirm('Are you sure you want to delete this employee? This will also delete all their related records.')) {
        setLoading(true);
        try {
            const { error } = await supabase.from('employees').delete().eq('id', id);
            if (error) throw error;
            alert('Employee deleted successfully');
            await loadAllData();
        } catch (error) {
            alert('Error deleting employee: ' + error.message);
        }
        setLoading(false);
    }
};

            const handleDeletePayroll = async (id) => {
                if (confirm('Are you sure you want to delete this payroll record? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('payrolls').delete().eq('id', id);
                        if (error) throw error;
                        alert('Payroll deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting payroll: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleDeleteLeave = async (id) => {
                if (confirm('Are you sure you want to delete this leave request? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('leave_requests').delete().eq('id', id);
                        if (error) throw error;
                        alert('Leave request deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting leave request: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleDeleteAttendance = async (id) => {
                if (confirm('Are you sure you want to delete this attendance record? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('attendance').delete().eq('id', id);
                        if (error) throw error;
                        alert('Attendance record deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting attendance record: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleAddPayroll = async () => {
    // Validate required fields
    if (!payrollForm.employeeId) {
        alert('Please select an employee');
        return;
    }
    
    if (!payrollForm.month) {
        alert('Please select a month');
        return;
    }
    
    if (!payrollForm.year) {
        alert('Please enter a year');
        return;
    }

    const employee = employees.find(e => e.id === parseInt(payrollForm.employeeId));
    if (!employee) {
        alert('Employee not found');
        return;
    }

    setLoading(true);
    try {
        const basicSalary = parseFloat(payrollForm.basicSalary) || employee.salary;
        const allowances = parseFloat(payrollForm.allowances) || 0;
        const overtimePay = parseFloat(payrollForm.overtimePay) || 0;
        const holidayPay = parseFloat(payrollForm.holidayPay) || 0;
        const bonus = parseFloat(payrollForm.bonus) || 0;
        
        const grossSalary = basicSalary + allowances + overtimePay + holidayPay + bonus;
        
        const tax = parseFloat(payrollForm.tax) || ((grossSalary * parseFloat(payrollForm.taxRate)) / 100);
        const pension = parseFloat(payrollForm.pension) || 0;
        const nhf = parseFloat(payrollForm.nhf) || 0;
        const loanDeduction = parseFloat(payrollForm.loanDeduction) || 0;
        const otherDeductions = parseFloat(payrollForm.otherDeductions) || 0;

        const totalDeductions = tax + pension + nhf + loanDeduction + otherDeductions;
        const netSalary = grossSalary - totalDeductions;

        const payslipNo = `PY${String(payrolls.length + 1).padStart(4, '0')}`;

        const payrollData = {
            employee_id: employee.id,
            employee_name: employee.name,
            month: payrollForm.month,
            year: parseInt(payrollForm.year),
            basic_salary: basicSalary,
            allowances: allowances,
            overtime_pay: overtimePay,
            holiday_pay: holidayPay,
            bonus: bonus,
            tax: tax,
            pension: pension,
            nhf: nhf,
            loan_deduction: loanDeduction,
            other_deductions: otherDeductions,
            gross_salary: grossSalary,
            net_salary: netSalary,
            payslip_no: payslipNo,
            working_days: parseInt(payrollForm.workingDays) || 30,
            pay_period_start: payrollForm.payPeriodStart || null,
            pay_period_end: payrollForm.payPeriodEnd || null,
            comments: payrollForm.comments || ''
        };

        console.log('Attempting to save payroll:', payrollData);

        const { data, error } = await supabase.from('payrolls').insert([payrollData]);

        if (error) {
            console.error('Payroll save error:', error);
            throw error;
        }

        console.log('Payroll saved successfully:', data);
        alert('Payroll generated successfully!');
        await loadAllData();
        closeModal();
    } catch (error) {
        console.error('Full payroll error:', error);
        alert('Error generating payroll: ' + error.message);
    }
    setLoading(false);
};

            const handleAddLeave = async () => {
                const empId = userRole === 'employee' ? currentUserId : parseInt(leaveForm.employeeId);
                const employee = employees.find(e => e.id === empId) || { id: empId, name: 'You' };

                const startDate = new Date(leaveForm.startDate);
                const endDate = new Date(leaveForm.endDate);
                const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

                setLoading(true);
                try {
                    await supabase.from('leave_requests').insert([{
                        employee_id: employee.id,
                        employee_name: employee.name,
                        start_date: leaveForm.startDate,
                        end_date: leaveForm.endDate,
                        days,
                        reason: leaveForm.reason,
                        type: leaveForm.type,
                        status: 'Pending'
                    }]);
                    await loadAllData();
                    closeModal();
                } catch (error) {
                    alert('Error submitting leave: ' + error.message);
                }
                setLoading(false);
            };

            const handleLeaveAction = async (id, action) => {
                const leave = leaveRequests.find(l => l.id === id);
                if (!leave) return;

                const newStatus = action === 'approve' ? 'Approved' : 'Rejected';
                setLoading(true);
                try {
                    await supabase.from('leave_requests').update({ status: newStatus }).eq('id', id);
                    if (action === 'approve') {
                        const employee = employees.find(e => e.id === leave.employee_id);
                        if (employee) {
                            await supabase.from('employees')
                                .update({ leave_balance: employee.leave_balance - leave.days })
                                .eq('id', leave.employee_id);
                        }
                    }
                    await loadAllData();
                } catch (error) {
                    alert('Error updating leave: ' + error.message);
                }
                setLoading(false);
            };

            const handleAddAttendance = async () => {
                const employee = employees.find(e => e.id === parseInt(attendanceForm.employeeId));
                if (!employee) return;

                setLoading(true);
                try {
                    await supabase.from('attendance').insert([{
                        employee_id: employee.id,
                        employee_name: employee.name,
                        date: attendanceForm.date,
                        status: attendanceForm.status
                    }]);
                    await loadAllData();
                    closeModal();
                } catch (error) {
                    alert('Error marking attendance: ' + error.message);
                }
                setLoading(false);
            };

            const handleAddResignation = async () => {
                const empId = userRole === 'employee' ? currentUserId : parseInt(resignationForm.employeeId);
                const employee = employees.find(e => e.id === empId) || { id: empId, name: 'You' };

                if (!resignationForm.resignationDate || !resignationForm.lastWorkingDate) {
                    alert('Please fill in all required fields');
                    return;
                }

                setLoading(true);
                try {
                    await supabase.from('resignations').insert([{
                        employee_id: employee.id,
                        employee_name: employee.name,
                        resignation_date: resignationForm.resignationDate,
                        last_working_date: resignationForm.lastWorkingDate,
                        reason: resignationForm.reason,
                        comments: resignationForm.comments,
                        status: 'Pending'
                    }]);
                    await loadAllData();
                    closeModal();
                    alert('Resignation submitted successfully!');
                } catch (error) {
                    alert('Error submitting resignation: ' + error.message);
                }
                setLoading(false);
            };

            const handleResignationAction = async (id, action) => {
                const resignation = resignations.find(r => r.id === id);
                if (!resignation) return;

                const newStatus = action === 'approve' ? 'Approved' : 'Rejected';
                setLoading(true);
                try {
                    await supabase.from('resignations').update({ status: newStatus }).eq('id', id);
                    await loadAllData();
                } catch (error) {
                    alert('Error updating resignation: ' + error.message);
                }
                setLoading(false);
            };

            const handleArchiveResignation = async (id) => {
                const resignation = resignations.find(r => r.id === id);
                if (!resignation || resignation.status !== 'Approved') {
                    alert('Only approved resignations can be archived');
                    return;
                }

                const employee = employees.find(e => e.id === resignation.employee_id);
                if (!employee) {
                    alert('Employee not found');
                    return;
                }

                if (confirm(`Archive employee ${employee.name}? This will move them to the archived employees section.`)) {
                    setLoading(true);
                    try {
                        // Archive the employee
                        await supabase.from('archived_employees').insert([{
                            employee_id: employee.id,
                            name: employee.name,
                            email: employee.email,
                            position: employee.position,
                            department: employee.department,
                            salary: employee.salary,
                            join_date: employee.join_date,
                            employee_code: employee.employee_code,
                            resignation_id: resignation.id,
                            resignation_date: resignation.resignation_date,
                            last_working_date: resignation.last_working_date,
                            resignation_reason: resignation.reason,
                            archived_at: new Date().toISOString()
                        }]);

                        // Mark resignation as archived
                        await supabase.from('resignations').update({ status: 'Archived' }).eq('id', id);

                        // Remove from active employees
                        await supabase.from('employees').delete().eq('id', employee.id);

                        await loadAllData();
                        alert('Employee archived successfully!');
                    } catch (error) {
                        alert('Error archiving employee: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleRestoreEmployee = async (id) => {
                const archivedEmployee = archivedEmployees.find(e => e.id === id);
                if (!archivedEmployee) return;

                if (confirm(`Restore employee ${archivedEmployee.name}? This will move them back to active employees.`)) {
                    setLoading(true);
                    try {
                        // Restore to active employees
                        await supabase.from('employees').insert([{
                            id: archivedEmployee.employee_id,
                            name: archivedEmployee.name,
                            email: archivedEmployee.email,
                            position: archivedEmployee.position,
                            department: archivedEmployee.department,
                            salary: archivedEmployee.salary,
                            join_date: archivedEmployee.join_date,
                            employee_code: archivedEmployee.employee_code,
                            password: 'employee123'
                        }]);

                        // Update resignation status back to approved
                        if (archivedEmployee.resignation_id) {
                            await supabase.from('resignations').update({ status: 'Approved' }).eq('id', archivedEmployee.resignation_id);
                        }

                        // Remove from archived
                        await supabase.from('archived_employees').delete().eq('id', id);

                        await loadAllData();
                        alert('Employee restored successfully!');
                    } catch (error) {
                        alert('Error restoring employee: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleDeleteResignation = async (id) => {
                if (confirm('Are you sure you want to delete this resignation request? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('resignations').delete().eq('id', id);
                        if (error) throw error;
                        alert('Resignation request deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting resignation request: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const handleAddPerformance = async () => {
                const employee = employees.find(e => e.id === parseInt(performanceForm.employeeId));
                if (!employee) {
                    alert('Please select an employee');
                    return;
                }

                if (!performanceForm.date) {
                    alert('Please select a date');
                    return;
                }

                setLoading(true);
                try {
                    const performanceData = {
                        employee_id: employee.id,
                        employee_name: employee.name,
                        date: performanceForm.date,
                        period_type: performanceForm.period_type,
                        overall_rating: parseInt(performanceForm.overall_rating),
                        quality_rating: parseInt(performanceForm.quality_rating),
                        productivity_rating: parseInt(performanceForm.productivity_rating),
                        teamwork_rating: parseInt(performanceForm.teamwork_rating),
                        communication_rating: parseInt(performanceForm.communication_rating),
                        punctuality_rating: parseInt(performanceForm.punctuality_rating),
                        goals_met: performanceForm.goals_met,
                        notes: performanceForm.notes || '',
                        created_at: new Date().toISOString()
                    };

                    await supabase.from('performance_records').insert([performanceData]);
                    alert('Performance record added successfully!');
                    await loadAllData();
                    closeModal();
                } catch (error) {
                    alert('Error adding performance record: ' + error.message);
                }
                setLoading(false);
            };

            const handleDeletePerformance = async (id) => {
                if (confirm('Are you sure you want to delete this performance record? This action cannot be undone.')) {
                    setLoading(true);
                    try {
                        const { error } = await supabase.from('performance_records').delete().eq('id', id);
                        if (error) throw error;
                        alert('Performance record deleted successfully');
                        await loadAllData();
                    } catch (error) {
                        alert('Error deleting performance record: ' + error.message);
                    }
                    setLoading(false);
                }
            };

            const getPerformanceStats = () => {
                const thisWeek = new Date();
                thisWeek.setDate(thisWeek.getDate() - thisWeek.getDay());
                const weekString = thisWeek.toISOString().split('T')[0];
                
                const thisMonth = new Date().toISOString().slice(0, 7);
                
                const weeklyRecords = performanceRecords.filter(p => p.date >= weekString && p.period_type === 'Weekly');
                const monthlyRecords = performanceRecords.filter(p => p.date.startsWith(thisMonth) && p.period_type === 'Monthly');
                
                const avgRating = performanceRecords.length > 0 
                    ? performanceRecords.reduce((sum, p) => sum + p.overall_rating, 0) / performanceRecords.length 
                    : 0;
                
                return {
                    weeklyRecords: weeklyRecords.length,
                    monthlyRecords: monthlyRecords.length,
                    averageRating: avgRating.toFixed(1),
                    totalRecords: performanceRecords.length
                };
            };

            const totalSalary = payrolls.reduce((sum, p) => sum + parseFloat(p.net_salary || 0), 0);
            const pendingLeaves = leaveRequests.filter(l => l.status === 'Pending').length;
            const todayDate = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance.filter(a => a.date === todayDate);
            const presentToday = todayAttendance.filter(a => a.status === 'Present').length;

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 to-orange-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                {settings.logo_url && (
                                    <img src={settings.logo_url} alt="Logo" className="h-20 mx-auto mb-4 object-contain" onError={(e) => e.target.style.display = 'none'} />
                                )}
                                <div className="inline-block p-3 bg-purple-100 rounded-full mb-4">
                                    <Icons.Lock />
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800">{settings.company_name || 'JulineMart'}</h1>
                                <p className="text-gray-600 mt-2">HR Management System</p>
                            </div>

                            {loginError && (
                                <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                    {loginError}
                                </div>
                            )}

                            <div className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Username or Email"
                                    value={loginForm.username}
                                    onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                    className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                />
                                <input
                                    type="password"
                                    placeholder="Password"
                                    value={loginForm.password}
                                    onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                    className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                />
                                <button
                                    onClick={handleLogin}
                                    disabled={loading}
                                    className="w-full bg-brand-purple hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-semibold disabled:bg-gray-300"
                                >
                                    {loading ? 'Logging in...' : 'Login'}
                                </button>
                                
                                <button
                                    type="button"
                                    onClick={() => setShowResetPassword(true)}
                                    className="w-full text-brand-purple hover:text-purple-700 text-sm font-medium mt-2"
                                >
                                    Forgot Password?
                                </button>
                            </div>

                            <div className="mt-6 text-center text-sm text-gray-600">
    <p className="text-xs text-gray-500">
        <strong>Admin:</strong> Login with your admin credentials<br />
        <strong>Employee:</strong> Login with your email address
    </p>
</div>
                        </div>
                        
                        {showResetPassword && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-8 max-w-md w-full">
                                    <h3 className="text-2xl font-bold mb-6 text-brand-purple">Reset Password</h3>
                                    
                                    {resetPasswordMessage && (
                                        <div className={`mb-4 p-4 rounded-lg ${
                                            resetPasswordMessage.includes('successful') 
                                                ? 'bg-green-100 border border-green-400 text-green-700'
                                                : 'bg-red-100 border border-red-400 text-red-700'
                                        }`}>
                                            {resetPasswordMessage}
                                        </div>
                                    )}
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Email Address</label>
                                            <input 
                                                type="email" 
                                                placeholder="Enter your email address"
                                                value={resetPasswordForm.email} 
                                                onChange={(e) => setResetPasswordForm({ email: e.target.value })}
                                                className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                                onKeyPress={(e) => e.key === 'Enter' && handleResetPassword()}
                                            />
                                            <p className="text-xs text-gray-500 mt-1">
                                                Enter the email address associated with your account
                                            </p>
                                        </div>
                                        
                                        <div className="flex space-x-3 mt-6">
                                            <button 
                                                onClick={handleResetPassword} 
                                                disabled={loading}
                                                className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-300"
                                            >
                                                {loading ? 'Resetting...' : 'Reset Password'}
                                            </button>
                                            <button 
                                                onClick={() => {
                                                    setShowResetPassword(false);
                                                    setResetPasswordForm({ email: '' });
                                                    setResetPasswordMessage('');
                                                }} 
                                                className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            if (userRole === 'employee') {
                const currentEmployee = employees[0] || {};
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-brand-purple text-white p-4 sm:p-6 shadow-lg">
                            <div className="container mx-auto flex justify-between items-center">
                                <div className="flex items-center space-x-3 sm:space-x-4">
                                    {settings.logo_url && (
                                        <img src={settings.logo_url} alt="Logo" className="h-10 sm:h-12 object-contain" onError={(e) => e.target.style.display = 'none'} />
                                    )}
                                    <div>
                                        <h1 className="text-lg sm:text-xl md:text-2xl font-bold">{settings.company_name || 'JulineMart'}</h1>
                                        <p className="text-purple-100 text-sm">Employee Portal</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-3 sm:space-x-4">
                                    <span className="hidden md:inline text-sm font-medium">Welcome, {currentEmployee.name}</span>
                                    <div className="relative profile-dropdown-container">
                                        <button
                                            onClick={() => setShowProfileDropdown(!showProfileDropdown)}
                                            className="flex items-center space-x-2 hover:bg-purple-600 rounded-lg p-2 transition-colors duration-200"
                                        >
                                            {currentEmployee.profile_pic ? (
                                                <img 
                                                    src={currentEmployee.profile_pic} 
                                                    alt={currentEmployee.name} 
                                                    className="w-10 h-10 rounded-full object-cover border-2 border-white" 
                                                    onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentEmployee.name || 'User') + '&background=7c3aed&color=fff'} 
                                                />
                                            ) : (
                                                <div className="w-10 h-10 rounded-full bg-purple-600 border-2 border-white text-white flex items-center justify-center font-bold">
                                                    {currentEmployee.name ? currentEmployee.name.charAt(0).toUpperCase() : 'U'}
                                                </div>
                                            )}
                                            <svg className={`w-4 h-4 transition-transform duration-200 ${showProfileDropdown ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </button>

                                        {showProfileDropdown && (
                                            <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border z-50 text-gray-800">
                                                <div className="p-6">
                                                    <div className="flex items-center space-x-4 mb-6">
                                                        {currentEmployee.profile_pic ? (
                                                            <img 
                                                                src={currentEmployee.profile_pic} 
                                                                alt={currentEmployee.name} 
                                                                className="w-16 h-16 rounded-full object-cover border-2 border-brand-purple" 
                                                                onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentEmployee.name || 'User') + '&background=7c3aed&color=fff'} 
                                                            />
                                                        ) : (
                                                            <div className="w-16 h-16 rounded-full bg-brand-purple text-white flex items-center justify-center font-bold text-xl border-2 border-brand-purple">
                                                                {currentEmployee.name ? currentEmployee.name.charAt(0).toUpperCase() : 'U'}
                                                            </div>
                                                        )}
                                                        <div>
                                                            <h3 className="text-xl font-bold text-gray-800">{currentEmployee.name || 'N/A'}</h3>
                                                            <p className="text-brand-purple font-medium">{currentEmployee.position || 'N/A'}</p>
                                                            <p className="text-sm text-gray-600">{currentEmployee.employee_code ? `ID: ${currentEmployee.employee_code}` : 'No ID assigned'}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="space-y-3 mb-6">
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Department:</span>
                                                            <span className="font-medium">{currentEmployee.department || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Email:</span>
                                                            <span className="font-medium">{currentEmployee.email || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Phone:</span>
                                                            <span className="font-medium">{currentEmployee.phone || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Join Date:</span>
                                                            <span className="font-medium">{currentEmployee.join_date || 'N/A'}</span>
                                                        </div>
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-gray-600">Leave Balance:</span>
                                                            <span className="font-bold text-green-600">{currentEmployee.leave_balance || 0} days</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="border-t pt-4">
                                                        <button
                                                            onClick={() => {
                                                                setShowProfileDropdown(false);
                                                                openModal('resignation');
                                                            }}
                                                            className="w-full flex items-center justify-center space-x-2 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 mb-3"
                                                        >
                                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                                                            </svg>
                                                            <span>Submit Resignation</span>
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                setShowProfileDropdown(false);
                                                                handleLogout();
                                                            }}
                                                            className="w-full flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200"
                                                        >
                                                            <Icons.Logout />
                                                            <span>Logout</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="container mx-auto px-6 py-8">
                            <div className="bg-white p-6 rounded-lg shadow-md mb-8">
                                <h3 className="text-xl font-bold mb-4">ðŸ“Š My Stats Overview</h3>
                                <div className="flex flex-wrap justify-center gap-4 mb-6">
                                    <div className="flex-1 min-w-48 text-center p-4 bg-purple-50 rounded-lg border border-purple-200">
                                        <p className="text-2xl font-bold text-brand-purple">{currentEmployee.leave_balance || 0}</p>
                                        <p className="text-sm text-gray-600">Remaining Leave Days</p>
                                    </div>
                                    <div className="flex-1 min-w-48 text-center p-4 bg-green-50 rounded-lg border border-green-200">
                                        <p className="text-2xl font-bold text-green-600">{payrolls.length}</p>
                                        <p className="text-sm text-gray-600">Total Payslips</p>
                                    </div>
                                    <div className="flex-1 min-w-48 text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                        <p className="text-2xl font-bold text-blue-600">{leaveRequests.filter(l => l.status === 'Approved').length}</p>
                                        <p className="text-sm text-gray-600">Approved Leaves</p>
                                    </div>
                                </div>
                                <BlogBannerCarousel blogBanners={blogBanners} />
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-lg shadow-md">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold">My Payslips</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {payrolls.slice(0, 5).map(pay => {
                                            const emp = currentEmployee;
                                            return (
                                                <div key={pay.id} className="border-b py-3 last:border-0 flex justify-between items-center">
                                                    <div>
                                                        <p className="font-semibold">{pay.month} {pay.year}</p>
                                                        <p className="text-sm text-gray-600">{pay.payslip_no}</p>
                                                    </div>
                                                    <div className="flex items-center space-x-3">
                                                        <p className="text-lg font-bold text-green-600">â‚¦{parseFloat(pay.net_salary).toLocaleString()}</p>
                                                        <button 
                                                            onClick={(e) => generatePDFPayslip(pay, emp, settings, e)} 
                                                            className="bg-brand-orange hover:bg-orange-600 text-white px-3 py-1 rounded-lg text-sm flex items-center space-x-1"
                                                        >
                                                            <Icons.Download />
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        {payrolls.length === 0 && <p className="text-gray-500 text-center py-4">No payslips yet</p>}
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-lg shadow-md">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold">My Leave Requests</h3>
                                        <button
                                            onClick={() => openModal('leave')}
                                            className="bg-brand-purple hover:bg-purple-700 text-white px-3 py-1 rounded-lg text-sm flex items-center space-x-1"
                                        >
                                            <Icons.Plus />
                                            <span>Request</span>
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        {leaveRequests.slice(0, 5).map(leave => (
                                            <div key={leave.id} className="border-b py-3 last:border-0">
                                                <div className="flex justify-between">
                                                    <div>
                                                        <p className="font-semibold">{leave.type} Leave</p>
                                                        <p className="text-sm text-gray-600">{leave.start_date} to {leave.end_date}</p>
                                                        <p className="text-xs text-gray-500">{leave.days} days</p>
                                                    </div>
                                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold h-fit ${
                                                        leave.status === 'Approved' ? 'bg-green-100 text-green-700' :
                                                        leave.status === 'Rejected' ? 'bg-red-100 text-red-700' :
                                                        'bg-yellow-100 text-yellow-700'
                                                    }`}>
                                                        {leave.status}
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                        {leaveRequests.length === 0 && <p className="text-gray-500 text-center py-4">No leave requests yet</p>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Company Apps Footer */}
                        <div className="bg-white border-t shadow-lg mt-8">
                            <div className="container mx-auto px-6 py-6">
                                <div className="text-center mb-4">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-2">Quick Access to Company Applications</h3>
                                    <p className="text-sm text-gray-500">Access other JulineMart systems directly</p>
                                </div>
                                <div className="flex flex-wrap justify-center gap-4">
                                    <a
                                        href="https://vform.julinemart.com"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="flex items-center space-x-2 bg-brand-purple hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 shadow-md"
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        <span>Vendor Sourcing App</span>
                                    </a>
                                    <a
                                        href="https://sku.julinemart.com"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="flex items-center space-x-2 bg-brand-orange hover:bg-orange-600 text-white px-6 py-3 rounded-lg transition-colors duration-200 shadow-md"
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                        </svg>
                                        <span>SKU App</span>
                                    </a>
                                    <a
                                        href="https://request.julinemart.com"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 shadow-md"
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                        </svg>
                                        <span>Requisition App</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        {showModal && modalType === 'leave' && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-8 max-w-md w-full max-h-screen overflow-y-auto">
                                    <h3 className="text-2xl font-bold mb-6 text-brand-purple">New Leave Request</h3>
                                    <div className="space-y-4">
                                        <select value={leaveForm.type} onChange={(e) => setLeaveForm({ ...leaveForm, type: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="Annual">Annual Leave</option>
                                            <option value="Sick">Sick Leave</option>
                                            <option value="Emergency">Emergency Leave</option>
                                            <option value="Unpaid">Unpaid Leave</option>
                                        </select>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Start Date</label>
                                            <input type="date" value={leaveForm.startDate} onChange={(e) => setLeaveForm({ ...leaveForm, startDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">End Date</label>
                                            <input type="date" value={leaveForm.endDate} onChange={(e) => setLeaveForm({ ...leaveForm, endDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Reason</label>
                                            <textarea placeholder="Reason for leave" value={leaveForm.reason} onChange={(e) => setLeaveForm({ ...leaveForm, reason: e.target.value })} className="w-full px-4 py-2 border rounded-lg" rows="3" />
                                        </div>
                                        <div className="flex space-x-3">
                                            <button onClick={handleAddLeave} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Submit</button>
                                            <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showModal && modalType === 'resignation' && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-8 max-w-md w-full max-h-screen overflow-y-auto">
                                    <h3 className="text-2xl font-bold mb-6 text-brand-purple">Submit Resignation</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Resignation Date *</label>
                                            <input 
                                                type="date" 
                                                value={resignationForm.resignationDate} 
                                                onChange={(e) => setResignationForm({ ...resignationForm, resignationDate: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Last Working Date *</label>
                                            <input 
                                                type="date" 
                                                value={resignationForm.lastWorkingDate} 
                                                onChange={(e) => setResignationForm({ ...resignationForm, lastWorkingDate: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Reason for Resignation</label>
                                            <select 
                                                value={resignationForm.reason} 
                                                onChange={(e) => setResignationForm({ ...resignationForm, reason: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg"
                                            >
                                                <option value="">Select a reason</option>
                                                <option value="Career Growth">Career Growth</option>
                                                <option value="Better Opportunity">Better Opportunity</option>
                                                <option value="Personal Reasons">Personal Reasons</option>
                                                <option value="Health Issues">Health Issues</option>
                                                <option value="Relocation">Relocation</option>
                                                <option value="Job Dissatisfaction">Job Dissatisfaction</option>
                                                <option value="Retirement">Retirement</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Additional Comments</label>
                                            <textarea 
                                                placeholder="Please provide any additional details..." 
                                                value={resignationForm.comments} 
                                                onChange={(e) => setResignationForm({ ...resignationForm, comments: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg" 
                                                rows="4"
                                            />
                                        </div>
                                        <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                            <p className="text-sm text-yellow-800">
                                                <strong>Note:</strong> Once submitted, this resignation request will be reviewed by HR/Admin. 
                                                Please ensure all details are correct before submitting.
                                            </p>
                                        </div>
                                        <div className="flex space-x-3">
                                            <button onClick={handleAddResignation} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Submit Resignation</button>
                                            <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-brand-purple text-white p-4 sm:p-6 shadow-lg">
                        <div className="container mx-auto flex justify-between items-center">
                            <div className="flex items-center space-x-3 sm:space-x-4">
                                {settings.logo_url && (
                                    <img src={settings.logo_url} alt="Logo" className="h-10 sm:h-12 object-contain" onError={(e) => e.target.style.display = 'none'} />
                                )}
                                <div>
                                    <h1 className="text-lg sm:text-xl md:text-2xl font-bold">{settings.company_name || 'JulineMart'}</h1>
                                    <p className="text-purple-100 text-sm">HR Management System</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-2 sm:space-x-3">
                                <button
                                    onClick={openAdminPasswordManagement}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-purple-700 hover:bg-purple-800 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Password Management"
                                >
                                    <Icons.Lock />
                                    <span className="hidden lg:inline">Password Management</span>
                                    <span className="hidden sm:inline lg:hidden">Passwords</span>
                                </button>
                                <button
                                    onClick={() => setShowChangePassword(true)}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-purple-700 hover:bg-purple-800 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Change Password"
                                >
                                    <Icons.Lock />
                                    <span className="hidden lg:inline">Change Password</span>
                                    <span className="hidden sm:inline lg:hidden">Password</span>
                                </button>
                                <button
                                    onClick={() => setShowSettings(true)}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-purple-700 hover:bg-purple-800 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Settings"
                                >
                                    <Icons.Settings />
                                    <span className="hidden sm:inline">Settings</span>
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="flex items-center space-x-1 sm:space-x-2 bg-red-600 hover:bg-red-700 px-2 py-2 sm:px-3 sm:py-2 rounded-lg text-xs sm:text-sm transition-colors duration-200"
                                    title="Logout"
                                >
                                    <Icons.Logout />
                                    <span className="hidden sm:inline">Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white shadow-md border-b">
                        <div className="container mx-auto px-6">
                            <div className="flex space-x-1 overflow-x-auto">
                                {[
                                    { id: 'dashboard', icon: Icons.Chart, label: 'Dashboard' },
                                    { id: 'employees', icon: Icons.Users, label: 'Employees' },
                                    { id: 'payroll', icon: Icons.Dollar, label: 'Payroll' },
                                    { id: 'leave', icon: Icons.Calendar, label: 'Leave' },
                                    { id: 'performance', icon: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>, label: 'Staff Performance' },
                                    { id: 'resignation', icon: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" /></svg>, label: 'Resignations' },
                                    { id: 'archive', icon: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8l6 6 6-6" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2v0" /></svg>, label: 'Archive' },
                                    { id: 'attendance', icon: Icons.Clock, label: 'Attendance' },
                                    { id: 'blog-banners', icon: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" /></svg>, label: 'Blog Banners' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center space-x-2 px-6 py-4 border-b-2 transition ${
                                            activeTab === tab.id
                                                ? 'border-brand-purple text-brand-purple'
                                                : 'border-transparent text-gray-600 hover:text-brand-purple'
                                        }`}
                                    >
                                        {React.createElement(tab.icon)}
                                        <span className="font-medium">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {loading && (
                        <div className="bg-brand-purple text-white text-center py-2">Loading...</div>
                    )}

                    <div className="container mx-auto px-6 py-8">
                        {activeTab === 'dashboard' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-6">Dashboard</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-brand-purple">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Total Employees</p>
                                                <p className="text-3xl font-bold text-brand-purple">{employees.length}</p>
                                            </div>
                                            <Icons.Users />
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-600">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Total Payroll</p>
                                                <p className="text-3xl font-bold text-green-600">â‚¦{totalSalary.toLocaleString()}</p>
                                            </div>
                                            <Icons.Dollar />
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-brand-orange">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Pending Leaves</p>
                                                <p className="text-3xl font-bold text-brand-orange">{pendingLeaves}</p>
                                            </div>
                                            <Icons.Calendar />
                                        </div>
                                    </div>
                                    <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-purple-600">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-gray-500 text-sm">Present Today</p>
                                                <p className="text-3xl font-bold text-purple-600">{presentToday}</p>
                                            </div>
                                            <Icons.Clock />
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="bg-white p-6 rounded-lg shadow-md">
                                        <h3 className="text-xl font-bold mb-4">Recent Employees</h3>
                                        {employees.slice(0, 5).map(emp => (
                                            <div key={emp.id} className="border-b py-3 last:border-0">
                                                <p className="font-semibold">{emp.name}</p>
                                                <p className="text-sm text-gray-600">{emp.position} â€¢ {emp.employee_code || 'No Code'}</p>
                                            </div>
                                        ))}
                                        {employees.length === 0 && <p className="text-gray-500 text-center py-4">No employees yet</p>}
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-md">
                                        <h3 className="text-xl font-bold mb-4">Recent Payrolls</h3>
                                        {payrolls.slice(0, 5).map(pay => (
                                            <div key={pay.id} className="border-b py-3 last:border-0 flex justify-between">
                                                <div>
                                                    <p className="font-semibold">{pay.employee_name}</p>
                                                    <p className="text-sm text-gray-600">{pay.month} {pay.year} â€¢ {pay.payslip_no}</p>
                                                </div>
                                                <p className="text-lg font-bold text-green-600">â‚¦{parseFloat(pay.net_salary).toLocaleString()}</p>
                                            </div>
                                        ))}
                                        {payrolls.length === 0 && <p className="text-gray-500 text-center py-4">No payrolls yet</p>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'employees' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Employees</h2>
                                    <button
                                        onClick={() => openModal('employee')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Add Employee</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Position</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bank</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Salary</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {employees.map(emp => (
    <tr key={emp.id}>
        <td className="px-6 py-4">
            <div className="flex items-center space-x-3">
                {emp.profile_pic ? (
                    <img src={emp.profile_pic} alt={emp.name} className="w-10 h-10 rounded-full object-cover" onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(emp.name) + '&background=7c3aed&color=fff'} />
                ) : (
                    <div className="w-10 h-10 rounded-full bg-brand-purple text-white flex items-center justify-center font-bold">
                        {emp.name.charAt(0).toUpperCase()}
                    </div>
                )}
                <div>
                    <p className="font-semibold">{emp.name}</p>
                    <p className="text-sm text-gray-500">{emp.email}</p>
                </div>
            </div>
        </td>
        <td className="px-6 py-4">{emp.employee_code || 'N/A'}</td>
        <td className="px-6 py-4">{emp.position}</td>
        <td className="px-6 py-4">
            <p className="text-sm">{emp.bank_name || 'N/A'}</p>
            <p className="text-xs text-gray-500">{emp.bank_account || ''}</p>
        </td>
        <td className="px-6 py-4">â‚¦{parseFloat(emp.salary).toLocaleString()}</td>
        <td className="px-6 py-4">
            <div className="flex space-x-2">
                <button onClick={() => openModal('employee', emp)} className="text-blue-600 hover:text-blue-800" title="Edit Employee">
                    <Icons.Edit />
                </button>
                <button onClick={() => handleAdminResetEmployeePassword(emp.id)} className="text-orange-600 hover:text-orange-800" title="Reset Password">
                    <Icons.Lock />
                </button>
                <button onClick={() => handleDeleteEmployee(emp.id)} className="text-red-600 hover:text-red-800" title="Delete Employee">
                    <Icons.Trash />
                </button>
            </div>
        </td>
    </tr>
))}
                                        </tbody>
                                    </table>
                                    {employees.length === 0 && <p className="text-center py-8 text-gray-500">No employees yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'payroll' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Payroll Management</h2>
                                    <button
                                        onClick={() => openModal('payroll')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Generate Payroll</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Payslip No</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Period</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Net Pay</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {payrolls.map(pay => {
                                                const employee = employees.find(e => e.id === pay.employee_id);
                                                return (
                                                    <tr key={pay.id}>
                                                        <td className="px-6 py-4 font-semibold">{pay.employee_name}</td>
                                                        <td className="px-6 py-4">{pay.payslip_no || 'N/A'}</td>
                                                        <td className="px-6 py-4">{pay.month} {pay.year}</td>
                                                        <td className="px-6 py-4 font-bold text-green-600">â‚¦{parseFloat(pay.net_salary).toLocaleString()}</td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex space-x-2">
                                                                <button 
                                                                    onClick={(e) => generatePDFPayslip(pay, employee || {}, settings, e)} 
                                                                    className="bg-brand-orange hover:bg-orange-600 text-white px-3 py-2 rounded-lg flex items-center space-x-1"
                                                                >
                                                                    <Icons.Download />
                                                                    <span>PDF</span>
                                                                </button>
                                                                <button 
                                                                    onClick={() => handleDeletePayroll(pay.id)} 
                                                                    className="text-red-600 hover:text-red-800 p-2"
                                                                >
                                                                    <Icons.Trash />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                    {payrolls.length === 0 && <p className="text-center py-8 text-gray-500">No payrolls yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'leave' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Leave Management</h2>
                                    <button
                                        onClick={() => openModal('leave')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>New Leave</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Duration</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Days</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reason</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {leaveRequests.map(leave => (
                                                <tr key={leave.id}>
                                                    <td className="px-6 py-4 font-semibold">{leave.employee_name}</td>
                                                    <td className="px-6 py-4 text-sm">{leave.start_date} to {leave.end_date}</td>
                                                    <td className="px-6 py-4">{leave.days}</td>
                                                    <td className="px-6 py-4 text-sm max-w-xs">
                                                        <div className="truncate" title={leave.reason || 'No reason provided'}>
                                                            {leave.reason || 'No reason provided'}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                            leave.status === 'Approved' ? 'bg-green-100 text-green-700' :
                                                            leave.status === 'Rejected' ? 'bg-red-100 text-red-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {leave.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="flex space-x-2">
                                                            {leave.status === 'Pending' && (
                                                                <>
                                                                    <button onClick={() => handleLeaveAction(leave.id, 'approve')} className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                                                        Approve
                                                                    </button>
                                                                    <button onClick={() => handleLeaveAction(leave.id, 'reject')} className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                                                        Reject
                                                                    </button>
                                                                </>
                                                            )}
                                                            <button 
                                                                onClick={() => handleDeleteLeave(leave.id)} 
                                                                className="text-red-600 hover:text-red-800 p-1"
                                                            >
                                                                <Icons.Trash />
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {leaveRequests.length === 0 && <p className="text-center py-8 text-gray-500">No leave requests yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'performance' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Staff Performance Management</h2>
                                    <button
                                        onClick={() => openModal('performance')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Add Performance Record</span>
                                    </button>
                                </div>

                                {/* Performance Statistics */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    {(() => {
                                        const stats = getPerformanceStats();
                                        return (
                                            <>
                                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <p className="text-gray-500 text-sm">Total Records</p>
                                                            <p className="text-3xl font-bold text-blue-500">{stats.totalRecords}</p>
                                                        </div>
                                                        <svg className="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <p className="text-gray-500 text-sm">Average Rating</p>
                                                            <p className="text-3xl font-bold text-green-500">{stats.averageRating}/5</p>
                                                        </div>
                                                        <svg className="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-yellow-500">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <p className="text-gray-500 text-sm">This Week</p>
                                                            <p className="text-3xl font-bold text-yellow-500">{stats.weeklyRecords}</p>
                                                        </div>
                                                        <svg className="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div className="bg-white p-6 rounded-lg shadow-md border-l-4 border-purple-500">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <p className="text-gray-500 text-sm">This Month</p>
                                                            <p className="text-3xl font-bold text-purple-500">{stats.monthlyRecords}</p>
                                                        </div>
                                                        <svg className="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </>
                                        );
                                    })()}
                                </div>

                                {/* Performance Records Table */}
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Period</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Overall Rating</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quality</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Productivity</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Teamwork</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Goals Met</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {performanceRecords.map(record => {
                                                const getRatingColor = (rating) => {
                                                    if (rating >= 4) return 'text-green-600 bg-green-100';
                                                    if (rating >= 3) return 'text-yellow-600 bg-yellow-100';
                                                    return 'text-red-600 bg-red-100';
                                                };
                                                
                                                const getRatingStars = (rating) => {
                                                    return 'â˜…'.repeat(rating) + 'â˜†'.repeat(5 - rating);
                                                };
                                                
                                                return (
                                                    <tr key={record.id}>
                                                        <td className="px-6 py-4">
                                                            <div className="flex items-center">
                                                                <div>
                                                                    <div className="font-semibold">{record.employee_name}</div>
                                                                    <div className="text-sm text-gray-500">ID: {record.employee_id}</div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm">{record.date}</td>
                                                        <td className="px-6 py-4">
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                                record.period_type === 'Weekly' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'
                                                            }`}>
                                                                {record.period_type}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className={`inline-flex px-3 py-1 rounded-full text-sm font-medium ${getRatingColor(record.overall_rating)}`}>
                                                                {getRatingStars(record.overall_rating)} ({record.overall_rating}/5)
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm">{getRatingStars(record.quality_rating)} ({record.quality_rating}/5)</td>
                                                        <td className="px-6 py-4 text-sm">{getRatingStars(record.productivity_rating)} ({record.productivity_rating}/5)</td>
                                                        <td className="px-6 py-4 text-sm">{getRatingStars(record.teamwork_rating)} ({record.teamwork_rating}/5)</td>
                                                        <td className="px-6 py-4">
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                                record.goals_met === 'Yes' ? 'bg-green-100 text-green-700' : 
                                                                record.goals_met === 'Partially' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'
                                                            }`}>
                                                                {record.goals_met}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex space-x-2">
                                                                <button 
                                                                    onClick={() => alert(`Performance Notes:\n${record.notes || 'No notes available'}\n\nDetailed Ratings:\nQuality: ${record.quality_rating}/5\nProductivity: ${record.productivity_rating}/5\nTeamwork: ${record.teamwork_rating}/5\nCommunication: ${record.communication_rating}/5\nPunctuality: ${record.punctuality_rating}/5`)}
                                                                    className="text-blue-600 hover:text-blue-800 p-1"
                                                                    title="View Details"
                                                                >
                                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                                                    </svg>
                                                                </button>
                                                                <button 
                                                                    onClick={() => handleDeletePerformance(record.id)} 
                                                                    className="text-red-600 hover:text-red-800 p-1"
                                                                    title="Delete Record"
                                                                >
                                                                    <Icons.Trash />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                    {performanceRecords.length === 0 && <p className="text-center py-8 text-gray-500">No performance records yet</p>}
                                </div>

                                {/* Performance Analytics Section */}
                                {performanceRecords.length > 0 && (
                                    <div className="mt-8 bg-white p-6 rounded-lg shadow-md">
                                        <h3 className="text-xl font-bold mb-4">ðŸ“Š Performance Analytics</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {/* Top Performers */}
                                            <div className="bg-green-50 p-4 rounded-lg">
                                                <h4 className="font-semibold text-green-800 mb-3">ðŸ† Top Performers (4.5+ Rating)</h4>
                                                <div className="space-y-2">
                                                    {performanceRecords
                                                        .filter(p => p.overall_rating >= 4.5)
                                                        .slice(0, 5)
                                                        .map(p => (
                                                            <div key={p.id} className="flex justify-between items-center">
                                                                <span className="text-sm font-medium">{p.employee_name}</span>
                                                                <span className="text-sm text-green-600">{p.overall_rating}/5</span>
                                                            </div>
                                                        ))
                                                    }
                                                    {performanceRecords.filter(p => p.overall_rating >= 4.5).length === 0 && (
                                                        <p className="text-sm text-gray-500">No top performers yet</p>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Needs Improvement */}
                                            <div className="bg-yellow-50 p-4 rounded-lg">
                                                <h4 className="font-semibold text-yellow-800 mb-3">âš ï¸ Needs Improvement (Below 3.0)</h4>
                                                <div className="space-y-2">
                                                    {performanceRecords
                                                        .filter(p => p.overall_rating < 3.0)
                                                        .slice(0, 5)
                                                        .map(p => (
                                                            <div key={p.id} className="flex justify-between items-center">
                                                                <span className="text-sm font-medium">{p.employee_name}</span>
                                                                <span className="text-sm text-yellow-600">{p.overall_rating}/5</span>
                                                            </div>
                                                        ))
                                                    }
                                                    {performanceRecords.filter(p => p.overall_rating < 3.0).length === 0 && (
                                                        <p className="text-sm text-gray-500">All performers above 3.0</p>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Recent Activity */}
                                            <div className="bg-blue-50 p-4 rounded-lg">
                                                <h4 className="font-semibold text-blue-800 mb-3">ðŸ•’ Recent Reviews</h4>
                                                <div className="space-y-2">
                                                    {performanceRecords
                                                        .slice(0, 5)
                                                        .map(p => (
                                                            <div key={p.id} className="flex justify-between items-center">
                                                                <span className="text-sm font-medium">{p.employee_name}</span>
                                                                <div className="flex items-center space-x-1">
                                                                    <span className="text-xs text-blue-600">{p.date}</span>
                                                                    <span className="text-sm text-blue-600">{p.overall_rating}/5</span>
                                                                </div>
                                                            </div>
                                                        ))
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'attendance' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Attendance</h2>
                                    <button
                                        onClick={() => openModal('attendance')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Mark Attendance</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {attendance.map(att => (
                                                <tr key={att.id}>
                                                    <td className="px-6 py-4 font-semibold">{att.employee_name}</td>
                                                    <td className="px-6 py-4">{att.date}</td>
                                                    <td className="px-6 py-4">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                            att.status === 'Present' ? 'bg-green-100 text-green-700' :
                                                            att.status === 'Absent' ? 'bg-red-100 text-red-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {att.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <button 
                                                            onClick={() => handleDeleteAttendance(att.id)} 
                                                            className="text-red-600 hover:text-red-800 p-1"
                                                        >
                                                            <Icons.Trash />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {attendance.length === 0 && <p className="text-center py-8 text-gray-500">No attendance records yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'resignation' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Resignation Management</h2>
                                    <button
                                        onClick={() => openModal('resignation')}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>New Resignation</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Resignation Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Last Working Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reason</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {resignations.map(resignation => (
                                                <tr key={resignation.id}>
                                                    <td className="px-6 py-4 font-semibold">{resignation.employee_name}</td>
                                                    <td className="px-6 py-4">{resignation.resignation_date}</td>
                                                    <td className="px-6 py-4">{resignation.last_working_date}</td>
                                                    <td className="px-6 py-4 text-sm max-w-xs">
                                                        <div className="truncate" title={resignation.reason || 'No reason provided'}>
                                                            {resignation.reason || 'No reason provided'}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                            resignation.status === 'Approved' ? 'bg-green-100 text-green-700' :
                                                            resignation.status === 'Rejected' ? 'bg-red-100 text-red-700' :
                                                            resignation.status === 'Archived' ? 'bg-blue-100 text-blue-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {resignation.status}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="flex space-x-2">
                                                            {resignation.status === 'Pending' && (
                                                                <>
                                                                    <button onClick={() => handleResignationAction(resignation.id, 'approve')} className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                                                        Approve
                                                                    </button>
                                                                    <button onClick={() => handleResignationAction(resignation.id, 'reject')} className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                                                        Reject
                                                                    </button>
                                                                </>
                                                            )}
                                                            {resignation.status === 'Approved' && (
                                                                <button onClick={() => handleArchiveResignation(resignation.id)} className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 flex items-center space-x-1">
                                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8l6 6 6-6" />
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2v0" />
                                                                    </svg>
                                                                    <span>Archive</span>
                                                                </button>
                                                            )}
                                                            <button 
                                                                onClick={() => handleDeleteResignation(resignation.id)} 
                                                                className="text-red-600 hover:text-red-800 p-1"
                                                            >
                                                                <Icons.Trash />
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {resignations.length === 0 && <p className="text-center py-8 text-gray-500">No resignation requests yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'archive' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Archived Employees</h2>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Employee</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Position</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Resignation Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Last Working Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Archived Date</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {archivedEmployees.map(emp => (
                                                <tr key={emp.id} className="bg-gray-50">
                                                    <td className="px-6 py-4">
                                                        <div>
                                                            <p className="font-semibold">{emp.name}</p>
                                                            <p className="text-sm text-gray-500">{emp.email}</p>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">{emp.position}</td>
                                                    <td className="px-6 py-4">{emp.resignation_date}</td>
                                                    <td className="px-6 py-4">{emp.last_working_date}</td>
                                                    <td className="px-6 py-4">{new Date(emp.archived_at).toLocaleDateString()}</td>
                                                    <td className="px-6 py-4">
                                                        <div className="flex space-x-2">
                                                            <button 
                                                                onClick={() => handleRestoreEmployee(emp.id)} 
                                                                className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 flex items-center space-x-1"
                                                                title="Restore employee to active list"
                                                            >
                                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                                                                </svg>
                                                                <span>Restore</span>
                                                            </button>
                                                            <button 
                                                                className="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700 flex items-center space-x-1"
                                                                title="View resignation details"
                                                                onClick={() => alert(`Resignation Reason: ${emp.resignation_reason || 'No reason provided'}\n\nComments: ${emp.comments || 'No additional comments'}`)}
                                                            >
                                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                                                </svg>
                                                                <span>Review</span>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {archivedEmployees.length === 0 && <p className="text-center py-8 text-gray-500">No archived employees yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'blog-banners' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">Blog Banner Management</h2>
                                    <button
                                        onClick={() => openBlogBannerModal()}
                                        className="bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                    >
                                        <Icons.Plus />
                                        <span>Add Banner</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-lg shadow-md overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Preview</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Link</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {blogBanners.map(banner => (
                                                <tr key={banner.id}>
                                                    <td className="px-6 py-4">
                                                        <img 
                                                            src={banner.image_url} 
                                                            alt={banner.title} 
                                                            className="w-16 h-10 object-cover rounded border"
                                                            onError={(e) => {
                                                                e.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2NCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNiAyMEgyNk0zOCAyMEgzOE0zMiAxNFYyNk0yNiAyMEwzOCAyMCIgc3Ryb2tlPSIjOUM5Qzk4IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K';
                                                            }}
                                                        />
                                                    </td>
                                                    <td className="px-6 py-4 font-semibold">{banner.title}</td>
                                                    <td className="px-6 py-4 text-sm max-w-xs">
                                                        <div className="truncate" title={banner.description || 'No description'}>
                                                            {banner.description || 'No description'}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 text-sm">
                                                        <a 
                                                            href={banner.link_url} 
                                                            target="_blank" 
                                                            rel="noopener noreferrer" 
                                                            className="text-blue-600 hover:text-blue-800 underline max-w-xs inline-block truncate"
                                                            title={banner.link_url}
                                                        >
                                                            {banner.link_url}
                                                        </a>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="flex space-x-2">
                                                            <button onClick={() => openBlogBannerModal(banner)} className="text-blue-600 hover:text-blue-800" title="Edit Banner">
                                                                <Icons.Edit />
                                                            </button>
                                                            <button onClick={() => handleDeleteBlogBanner(banner.id)} className="text-red-600 hover:text-red-800" title="Delete Banner">
                                                                <Icons.Trash />
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {blogBanners.length === 0 && <p className="text-center py-8 text-gray-500">No blog banners yet</p>}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Company Apps Footer */}
                    <div className="bg-white border-t shadow-lg mt-8">
                        <div className="container mx-auto px-6 py-6">
                            <div className="text-center mb-4">
                                <h3 className="text-lg font-semibold text-gray-700 mb-2">Quick Access to Company Applications</h3>
                                <p className="text-sm text-gray-500">Access other JulineMart systems directly</p>
                            </div>
                            <div className="flex flex-wrap justify-center gap-4">
                                <a
                                    href="https://vform.julinemart.com"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="flex items-center space-x-2 bg-brand-purple hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 shadow-md"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span>Vendor Sourcing App</span>
                                </a>
                                <a
                                    href="https://sku.julinemart.com"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="flex items-center space-x-2 bg-brand-orange hover:bg-orange-600 text-white px-6 py-3 rounded-lg transition-colors duration-200 shadow-md"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                    </svg>
                                    <span>SKU App</span>
                                </a>
                                <a
                                    href="https://request.julinemart.com"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 shadow-md"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                    </svg>
                                    <span>Requisition App</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    {showModal && modalType === 'employee' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-2xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">{editingItem ? 'Edit' : 'Add'} Employee</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" placeholder="Full Name *" value={employeeForm.name} onChange={(e) => setEmployeeForm({ ...employeeForm, name: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Employee Code" value={employeeForm.employeeCode} onChange={(e) => setEmployeeForm({ ...employeeForm, employeeCode: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="email" placeholder="Email *" value={employeeForm.email} onChange={(e) => setEmployeeForm({ ...employeeForm, email: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Phone" value={employeeForm.phone} onChange={(e) => setEmployeeForm({ ...employeeForm, phone: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Position *" value={employeeForm.position} onChange={(e) => setEmployeeForm({ ...employeeForm, position: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Department" value={employeeForm.department} onChange={(e) => setEmployeeForm({ ...employeeForm, department: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="number" placeholder="Salary *" value={employeeForm.salary} onChange={(e) => setEmployeeForm({ ...employeeForm, salary: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Bank Name" value={employeeForm.bankName} onChange={(e) => setEmployeeForm({ ...employeeForm, bankName: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" placeholder="Bank Account" value={employeeForm.bankAccount} onChange={(e) => setEmployeeForm({ ...employeeForm, bankAccount: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <select value={employeeForm.paymentMode} onChange={(e) => setEmployeeForm({ ...employeeForm, paymentMode: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="Bank">Bank Transfer</option>
                                        <option value="Cash">Cash</option>
                                        <option value="Cheque">Cheque</option>
                                    </select>
                                    <input type="date" placeholder="Join Date" value={employeeForm.joinDate} onChange={(e) => setEmployeeForm({ ...employeeForm, joinDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="number" placeholder="Leave Balance (days)" value={employeeForm.leaveBalance} onChange={(e) => setEmployeeForm({ ...employeeForm, leaveBalance: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium mb-2">Profile Picture URL</label>
                                        <input type="text" placeholder="https://example.com/photo.jpg" value={employeeForm.profilePic} onChange={(e) => setEmployeeForm({ ...employeeForm, profilePic: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        <p className="text-xs text-gray-500 mt-1">Upload photo to GitHub or use direct image URL</p>
                                        {employeeForm.profilePic && (
                                            <div className="mt-2">
                                                <img src={employeeForm.profilePic} alt="Preview" className="w-16 h-16 rounded-full object-cover" onError={(e) => e.target.style.display = 'none'} />
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-700">
                                    <p><strong>Note:</strong> Employee default password is "employee123". They can login with their email.</p>
                                </div>
                                <div className="flex space-x-3 mt-6">
                                    <button onClick={handleAddEmployee} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Save</button>
                                    <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'payroll' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Generate Payroll</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium mb-1">Select Employee *</label>
                                        <select value={payrollForm.employeeId} onChange={(e) => setPayrollForm({ ...payrollForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="">Select Employee</option>
                                            {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name} ({emp.employee_code || emp.id})</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Month *</label>
                                        <select value={payrollForm.month} onChange={(e) => setPayrollForm({ ...payrollForm, month: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="">Select Month</option>
                                            {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map(m => <option key={m} value={m}>{m}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Year *</label>
                                        <input type="number" placeholder="2024" value={payrollForm.year} onChange={(e) => setPayrollForm({ ...payrollForm, year: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Pay Period Start</label>
                                        <input type="date" value={payrollForm.payPeriodStart} onChange={(e) => setPayrollForm({ ...payrollForm, payPeriodStart: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Pay Period End</label>
                                        <input type="date" value={payrollForm.payPeriodEnd} onChange={(e) => setPayrollForm({ ...payrollForm, payPeriodEnd: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Working Days (Total days worked this period)</label>
                                        <input type="number" placeholder="30" value={payrollForm.workingDays} onChange={(e) => setPayrollForm({ ...payrollForm, workingDays: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                </div>

                                <div className="border-t pt-4 mb-4">
                                    <h4 className="font-bold text-green-700 mb-3">ðŸ’° EARNINGS (Income)</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Basic Salary (Leave empty to use default)</label>
                                            <input type="number" placeholder="Auto from employee record" value={payrollForm.basicSalary} onChange={(e) => setPayrollForm({ ...payrollForm, basicSalary: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Allowances (Transport, Housing, etc.)</label>
                                            <input type="number" placeholder="0" value={payrollForm.allowances} onChange={(e) => setPayrollForm({ ...payrollForm, allowances: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Overtime Pay</label>
                                            <input type="number" placeholder="0" value={payrollForm.overtimePay} onChange={(e) => setPayrollForm({ ...payrollForm, overtimePay: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Holiday Pay</label>
                                            <input type="number" placeholder="0" value={payrollForm.holidayPay} onChange={(e) => setPayrollForm({ ...payrollForm, holidayPay: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Bonus / Incentive / Commission</label>
                                            <input type="number" placeholder="0" value={payrollForm.bonus} onChange={(e) => setPayrollForm({ ...payrollForm, bonus: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                    </div>
                                </div>

                                <div className="border-t pt-4 mb-4">
                                    <h4 className="font-bold text-red-700 mb-3">âž– DEDUCTIONS</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tax/PAYE (Or use % below)</label>
                                            <input type="number" placeholder="0" value={payrollForm.tax} onChange={(e) => setPayrollForm({ ...payrollForm, tax: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tax Rate % (If amount above is 0)</label>
                                            <input type="number" placeholder="10" value={payrollForm.taxRate} onChange={(e) => setPayrollForm({ ...payrollForm, taxRate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Pension Contribution</label>
                                            <input type="number" placeholder="0" value={payrollForm.pension} onChange={(e) => setPayrollForm({ ...payrollForm, pension: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">NHF (National Housing Fund)</label>
                                            <input type="number" placeholder="0" value={payrollForm.nhf} onChange={(e) => setPayrollForm({ ...payrollForm, nhf: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Loan Repayment</label>
                                            <input type="number" placeholder="0" value={payrollForm.loanDeduction} onChange={(e) => setPayrollForm({ ...payrollForm, loanDeduction: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Other Deductions (Insurance, etc.)</label>
                                            <input type="number" placeholder="0" value={payrollForm.otherDeductions} onChange={(e) => setPayrollForm({ ...payrollForm, otherDeductions: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                        </div>
                                    </div>
                                </div>

                                <div className="border-t pt-4">
                                    <label className="block text-sm font-medium mb-1">Comments (Optional)</label>
                                    <textarea placeholder="Any additional notes..." value={payrollForm.comments} onChange={(e) => setPayrollForm({ ...payrollForm, comments: e.target.value })} className="w-full px-4 py-2 border rounded-lg" rows="3" />
                                </div>

                                <div className="flex space-x-3 mt-6">
                                    <button onClick={handleAddPayroll} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Generate Payroll</button>
                                    <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'leave' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">New Leave Request</h3>
                                <div className="space-y-4">
                                    <select value={leaveForm.employeeId} onChange={(e) => setLeaveForm({ ...leaveForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="">Select Employee *</option>
                                        {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                                    </select>
                                    <select value={leaveForm.type} onChange={(e) => setLeaveForm({ ...leaveForm, type: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="Annual">Annual Leave</option>
                                        <option value="Sick">Sick Leave</option>
                                        <option value="Emergency">Emergency Leave</option>
                                        <option value="Unpaid">Unpaid Leave</option>
                                    </select>
                                    <input type="date" value={leaveForm.startDate} onChange={(e) => setLeaveForm({ ...leaveForm, startDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="date" value={leaveForm.endDate} onChange={(e) => setLeaveForm({ ...leaveForm, endDate: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <textarea placeholder="Reason" value={leaveForm.reason} onChange={(e) => setLeaveForm({ ...leaveForm, reason: e.target.value })} className="w-full px-4 py-2 border rounded-lg" rows="3" />
                                    <div className="flex space-x-3">
                                        <button onClick={handleAddLeave} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Submit</button>
                                        <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'attendance' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Mark Attendance</h3>
                                <div className="space-y-4">
                                    <select value={attendanceForm.employeeId} onChange={(e) => setAttendanceForm({ ...attendanceForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="">Select Employee *</option>
                                        {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                                    </select>
                                    <input type="date" value={attendanceForm.date} onChange={(e) => setAttendanceForm({ ...attendanceForm, date: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                                    <select value={attendanceForm.status} onChange={(e) => setAttendanceForm({ ...attendanceForm, status: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="Present">Present</option>
                                        <option value="Absent">Absent</option>
                                        <option value="Half Day">Half Day</option>
                                        <option value="Late">Late</option>
                                    </select>
                                    <div className="flex space-x-3">
                                        <button onClick={handleAddAttendance} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Mark</button>
                                        <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal && modalType === 'resignation' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Submit Resignation</h3>
                                <div className="space-y-4">
                                    {userRole === 'admin' && (
                                        <select value={resignationForm.employeeId} onChange={(e) => setResignationForm({ ...resignationForm, employeeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                                            <option value="">Select Employee *</option>
                                            {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.name}</option>)}
                                        </select>
                                    )}
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Resignation Date *</label>
                                        <input 
                                            type="date" 
                                            value={resignationForm.resignationDate} 
                                            onChange={(e) => setResignationForm({ ...resignationForm, resignationDate: e.target.value })} 
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Last Working Date *</label>
                                        <input 
                                            type="date" 
                                            value={resignationForm.lastWorkingDate} 
                                            onChange={(e) => setResignationForm({ ...resignationForm, lastWorkingDate: e.target.value })} 
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Reason for Resignation</label>
                                        <select 
                                            value={resignationForm.reason} 
                                            onChange={(e) => setResignationForm({ ...resignationForm, reason: e.target.value })} 
                                            className="w-full px-4 py-2 border rounded-lg"
                                        >
                                            <option value="">Select a reason</option>
                                            <option value="Career Growth">Career Growth</option>
                                            <option value="Better Opportunity">Better Opportunity</option>
                                            <option value="Personal Reasons">Personal Reasons</option>
                                            <option value="Health Issues">Health Issues</option>
                                            <option value="Relocation">Relocation</option>
                                            <option value="Job Dissatisfaction">Job Dissatisfaction</option>
                                            <option value="Retirement">Retirement</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Additional Comments</label>
                                        <textarea 
                                            placeholder="Please provide any additional details..." 
                                            value={resignationForm.comments} 
                                            onChange={(e) => setResignationForm({ ...resignationForm, comments: e.target.value })} 
                                            className="w-full px-4 py-2 border rounded-lg" 
                                            rows="4"
                                        />
                                    </div>
                                    <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                        <p className="text-sm text-yellow-800">
                                            <strong>Note:</strong> Once submitted, this resignation request will be reviewed by HR/Admin. 
                                            Please ensure all details are correct before submitting.
                                        </p>
                                    </div>
                                    <div className="flex space-x-3">
                                        <button onClick={handleAddResignation} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">Submit Resignation</button>
                                        <button onClick={closeModal} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showAdminPasswordManagement && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Employee Password Management</h3>
                                
                                {passwordManagementMessage && (
                                    <div className={`mb-6 p-4 rounded-lg ${
                                        passwordManagementMessage.includes('successfully') || passwordManagementMessage.includes('reset to')
                                            ? 'bg-green-100 border border-green-400 text-green-700'
                                            : 'bg-red-100 border border-red-400 text-red-700'
                                    }`}>
                                        {passwordManagementMessage}
                                    </div>
                                )}

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Reset Password Section */}
                                    <div className="bg-orange-50 p-6 rounded-lg border border-orange-200">
                                        <h4 className="text-xl font-semibold mb-4 text-orange-800">Quick Password Reset</h4>
                                        <p className="text-sm text-gray-600 mb-4">Reset employee password to default "employee123"</p>
                                        
                                        <div className="space-y-4">
                                            <div className="max-h-80 overflow-y-auto">
                                                <table className="w-full">
                                                    <thead className="bg-orange-100 sticky top-0">
                                                        <tr>
                                                            <th className="px-4 py-2 text-left text-sm font-medium">Employee</th>
                                                            <th className="px-4 py-2 text-center text-sm font-medium">Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-orange-200">
                                                        {employees.map(emp => (
                                                            <tr key={emp.id}>
                                                                <td className="px-4 py-3">
                                                                    <div className="flex items-center space-x-3">
                                                                        {emp.profile_pic ? (
                                                                            <img src={emp.profile_pic} alt={emp.name} className="w-8 h-8 rounded-full object-cover" onError={(e) => e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(emp.name) + '&background=7c3aed&color=fff'} />
                                                                        ) : (
                                                                            <div className="w-8 h-8 rounded-full bg-brand-purple text-white flex items-center justify-center font-bold text-sm">
                                                                                {emp.name.charAt(0).toUpperCase()}
                                                                            </div>
                                                                        )}
                                                                        <div>
                                                                            <p className="font-medium text-sm">{emp.name}</p>
                                                                            <p className="text-xs text-gray-500">{emp.position}</p>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td className="px-4 py-3 text-center">
                                                                    <button
                                                                        onClick={() => handleAdminResetEmployeePassword(emp.id)}
                                                                        disabled={loading}
                                                                        className="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm disabled:bg-gray-300"
                                                                    >
                                                                        Reset
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                                {employees.length === 0 && <p className="text-center py-4 text-gray-500">No employees found</p>}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Custom Password Section */}
                                    <div className="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                        <h4 className="text-xl font-semibold mb-4 text-blue-800">Set Custom Password</h4>
                                        <p className="text-sm text-gray-600 mb-4">Set a specific password for an employee</p>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Select Employee</label>
                                                <select 
                                                    value={selectedEmployeeForPassword || ''} 
                                                    onChange={(e) => setSelectedEmployeeForPassword(e.target.value ? parseInt(e.target.value) : null)}
                                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                >
                                                    <option value="">Choose Employee</option>
                                                    {employees.map(emp => (
                                                        <option key={emp.id} value={emp.id}>{emp.name} - {emp.position}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium mb-2">New Password</label>
                                                <input 
                                                    type="password" 
                                                    placeholder="Enter new password (min 6 characters)"
                                                    value={adminPasswordForm.newPassword} 
                                                    onChange={(e) => setAdminPasswordForm({ ...adminPasswordForm, newPassword: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                    minLength="6"
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Confirm New Password</label>
                                                <input 
                                                    type="password" 
                                                    placeholder="Confirm new password"
                                                    value={adminPasswordForm.confirmPassword} 
                                                    onChange={(e) => setAdminPasswordForm({ ...adminPasswordForm, confirmPassword: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                    minLength="6"
                                                />
                                            </div>
                                            
                                            <button 
                                                onClick={handleAdminChangeEmployeePassword}
                                                disabled={loading || !selectedEmployeeForPassword || !adminPasswordForm.newPassword || !adminPasswordForm.confirmPassword}
                                                className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-300"
                                            >
                                                {loading ? 'Updating...' : 'Update Password'}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Security Notice */}
                                <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <h5 className="font-semibold text-yellow-800 mb-2">ðŸ”’ Security Notice</h5>
                                    <div className="text-sm text-yellow-700 space-y-1">
                                        <p>â€¢ Employees can login using their email address and the password you set</p>
                                        <p>â€¢ Default reset password is "employee123"</p>
                                        <p>â€¢ Consider informing employees when their passwords are changed</p>
                                        <p>â€¢ Encourage employees to use secure passwords when possible</p>
                                    </div>
                                </div>

                                <div className="flex justify-end mt-8">
                                    <button 
                                        onClick={closeAdminPasswordManagement}
                                        className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-semibold"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showSettings && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-3xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Company Settings</h3>
                                
                                <div className="space-y-6">
                                    <div className="bg-purple-50 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4 text-lg">Company Information</h4>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Company Name</label>
                                                <input 
                                                    type="text" 
                                                    value={settingsForm.company_name || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, company_name: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Address</label>
                                                <textarea 
                                                    value={settingsForm.company_address || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, company_address: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                    rows="3"
                                                    placeholder="Street Address&#10;City, State&#10;Country"
                                                />
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Phone</label>
                                                    <input 
                                                        type="text" 
                                                        value={settingsForm.company_phone || ''} 
                                                        onChange={(e) => setSettingsForm({ ...settingsForm, company_phone: e.target.value })}
                                                        className="w-full px-4 py-2 border rounded-lg"
                                                        placeholder="+234 XXX XXX XXXX"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Email</label>
                                                    <input 
                                                        type="email" 
                                                        value={settingsForm.company_email || ''} 
                                                        onChange={(e) => setSettingsForm({ ...settingsForm, company_email: e.target.value })}
                                                        className="w-full px-4 py-2 border rounded-lg"
                                                        placeholder="hr@company.com"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-orange-50 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4 text-lg">Logo & Branding</h4>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Logo URL</label>
                                                <input 
                                                    type="text" 
                                                    value={settingsForm.logo_url || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, logo_url: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                    placeholder="https://yoursite.com/logo.png"
                                                />
                                                <p className="text-xs text-gray-600 mt-2">Tip: Upload your logo to your GitHub repository, then use the raw URL</p>
                                                <p className="text-xs text-gray-500">Example: https://raw.githubusercontent.com/username/repo/main/logo.png</p>
                                            </div>
                                            {settingsForm.logo_url && (
                                                <div className="mt-3">
                                                    <p className="text-sm font-medium mb-2">Logo Preview:</p>
                                                    <img src={settingsForm.logo_url} alt="Logo" className="h-20 border rounded object-contain bg-white p-2" onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'block';
                                                    }} />
                                                    <p className="text-red-500 text-sm mt-2" style={{display: 'none'}}>Failed to load logo. Please check the URL.</p>
                                                </div>
                                            )}
                                            
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Digital Signature/Stamp URL</label>
                                                <input 
                                                    type="text" 
                                                    value={settingsForm.digital_signature_url || ''} 
                                                    onChange={(e) => setSettingsForm({ ...settingsForm, digital_signature_url: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg"
                                                    placeholder="https://yoursite.com/signature.png"
                                                />
                                                <p className="text-xs text-gray-600 mt-2">Add a digital signature or company stamp to appear on all payslips</p>
                                                <p className="text-xs text-gray-500">Recommended size: 200x60 pixels (transparent PNG)</p>
                                            </div>
                                            {settingsForm.digital_signature_url && (
                                                <div className="mt-3">
                                                    <p className="text-sm font-medium mb-2">Signature Preview:</p>
                                                    <img src={settingsForm.digital_signature_url} alt="Signature" className="h-12 border rounded object-contain bg-white p-2" onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'block';
                                                    }} />
                                                    <p className="text-red-500 text-sm mt-2" style={{display: 'none'}}>Failed to load signature. Please check the URL.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4 text-lg">Payslip Footer</h4>
                                        <textarea 
                                            value={settingsForm.payslip_footer || ''} 
                                            onChange={(e) => setSettingsForm({ ...settingsForm, payslip_footer: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                            rows="2"
                                            placeholder="This is a computer-generated payslip and does not require a signature."
                                        />
                                    </div>
                                </div>

                                <div className="flex space-x-3 mt-8">
                                    <button onClick={saveSettings} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-semibold">
                                        Save Settings
                                    </button>
                                    <button onClick={() => setShowSettings(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-3 rounded-lg font-semibold">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showChangePassword && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-md w-full">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Change Password</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Current Password</label>
                                        <input 
                                            type="password" 
                                            value={passwordForm.currentPassword} 
                                            onChange={(e) => setPasswordForm({ ...passwordForm, currentPassword: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">New Password</label>
                                        <input 
                                            type="password" 
                                            value={passwordForm.newPassword} 
                                            onChange={(e) => setPasswordForm({ ...passwordForm, newPassword: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Confirm New Password</label>
                                        <input 
                                            type="password" 
                                            value={passwordForm.confirmPassword} 
                                            onChange={(e) => setPasswordForm({ ...passwordForm, confirmPassword: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div className="flex space-x-3 mt-6">
                                        <button onClick={handleChangePassword} className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">
                                            Change Password
                                        </button>
                                        <button onClick={() => setShowChangePassword(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showBlogBannerModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-2xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">{editingBanner ? 'Edit' : 'Add'} Blog Banner</h3>
                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Banner Title *</label>
                                        <input 
                                            type="text" 
                                            placeholder="Enter banner title" 
                                            value={blogBannerForm.title} 
                                            onChange={(e) => setBlogBannerForm({ ...blogBannerForm, title: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Image URL *</label>
                                        <input 
                                            type="text" 
                                            placeholder="https://example.com/banner-image.jpg" 
                                            value={blogBannerForm.image_url} 
                                            onChange={(e) => {
                                                const cleanUrl = e.target.value.trim();
                                                setBlogBannerForm({ ...blogBannerForm, image_url: cleanUrl });
                                            }}
                                            onPaste={(e) => {
                                                setTimeout(() => {
                                                    const pastedValue = e.target.value.trim();
                                                    if (pastedValue !== blogBannerForm.image_url) {
                                                        setBlogBannerForm({ ...blogBannerForm, image_url: pastedValue });
                                                    }
                                                }, 10);
                                            }}
                                            className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                        />
                                        <p className="text-xs text-gray-600 mt-2">
                                            Upload your image to GitHub or use a direct image URL (recommended size: 800x200px)<br />
                                            <strong>Tips:</strong> Try pasting the URL directly, or use Ctrl+V/Cmd+V to paste
                                        </p>
                                        {blogBannerForm.image_url && (
                                            <div className="mt-3">
                                                <p className="text-sm font-medium mb-2">Image Preview:</p>
                                                <div className="relative">
                                                    <img 
                                                        src={blogBannerForm.image_url} 
                                                        alt="Preview" 
                                                        className="h-20 w-auto border rounded object-cover" 
                                                        onLoad={(e) => {
                                                            e.target.style.display = 'block';
                                                            if (e.target.nextElementSibling) {
                                                                e.target.nextElementSibling.style.display = 'none';
                                                            }
                                                        }}
                                                        onError={(e) => {
                                                            e.target.style.display = 'none';
                                                            if (e.target.nextElementSibling) {
                                                                e.target.nextElementSibling.style.display = 'block';
                                                            }
                                                        }} 
                                                    />
                                                    <p className="text-red-500 text-sm mt-2" style={{display: 'none'}}>
                                                        Failed to load image. Please check the URL format and ensure it's a direct link to an image file.
                                                    </p>
                                                </div>
                                                <div className="mt-2 text-xs text-gray-500">
                                                    URL: <span className="font-mono bg-gray-100 px-1 py-0.5 rounded">{blogBannerForm.image_url}</span>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Blog Post Link *</label>
                                        <input 
                                            type="url" 
                                            placeholder="https://yourwebsite.com/blog-post" 
                                            value={blogBannerForm.link_url} 
                                            onChange={(e) => setBlogBannerForm({ ...blogBannerForm, link_url: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                        />
                                        <p className="text-xs text-gray-600 mt-2">URL where users will be redirected when they click the banner</p>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Description (Optional)</label>
                                        <textarea 
                                            placeholder="Brief description of the blog post..." 
                                            value={blogBannerForm.description} 
                                            onChange={(e) => setBlogBannerForm({ ...blogBannerForm, description: e.target.value })}
                                            className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" 
                                            rows="3"
                                        />
                                    </div>
                                </div>
                                <div className="flex space-x-3 mt-8">
                                    <button 
                                        onClick={handleAddBlogBanner} 
                                        disabled={loading}
                                        className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-300"
                                    >
                                        {loading ? 'Saving...' : 'Save Banner'}
                                    </button>
                                    <button 
                                        onClick={closeBlogBannerModal} 
                                        className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded-lg font-semibold"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showModal && modalType === 'performance' && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-brand-purple">Add Performance Record</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Employee and Basic Info */}
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Select Employee *</label>
                                            <select 
                                                value={performanceForm.employeeId} 
                                                onChange={(e) => setPerformanceForm({ ...performanceForm, employeeId: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                            >
                                                <option value="">Choose Employee</option>
                                                {employees.map(emp => (
                                                    <option key={emp.id} value={emp.id}>{emp.name} - {emp.position}</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Review Date *</label>
                                            <input 
                                                type="date" 
                                                value={performanceForm.date} 
                                                onChange={(e) => setPerformanceForm({ ...performanceForm, date: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Review Period</label>
                                            <select 
                                                value={performanceForm.period_type} 
                                                onChange={(e) => setPerformanceForm({ ...performanceForm, period_type: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                            >
                                                <option value="Weekly">Weekly Review</option>
                                                <option value="Monthly">Monthly Review</option>
                                                <option value="Quarterly">Quarterly Review</option>
                                                <option value="Annual">Annual Review</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Goals Achievement</label>
                                            <select 
                                                value={performanceForm.goals_met} 
                                                onChange={(e) => setPerformanceForm({ ...performanceForm, goals_met: e.target.value })} 
                                                className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                            >
                                                <option value="Yes">Yes - Goals Met</option>
                                                <option value="Partially">Partially - Some Goals Met</option>
                                                <option value="No">No - Goals Not Met</option>
                                            </select>
                                        </div>
                                    </div>

                                    {/* Rating Categories */}
                                    <div className="space-y-4">
                                        <h4 className="font-semibold text-lg text-gray-700 mb-4">Performance Ratings (1-5 Scale)</h4>
                                        
                                        {[
                                            { key: 'overall_rating', label: 'Overall Performance', desc: 'General performance assessment' },
                                            { key: 'quality_rating', label: 'Work Quality', desc: 'Quality of work delivered' },
                                            { key: 'productivity_rating', label: 'Productivity', desc: 'Efficiency and output' },
                                            { key: 'teamwork_rating', label: 'Teamwork & Collaboration', desc: 'Works well with team' },
                                            { key: 'communication_rating', label: 'Communication', desc: 'Communication skills' },
                                            { key: 'punctuality_rating', label: 'Punctuality & Reliability', desc: 'Timeliness and dependability' }
                                        ].map(rating => (
                                            <div key={rating.key} className="bg-gray-50 p-4 rounded-lg">
                                                <label className="block text-sm font-medium mb-2">{rating.label}</label>
                                                <p className="text-xs text-gray-500 mb-3">{rating.desc}</p>
                                                <div className="flex items-center space-x-4">
                                                    <input 
                                                        type="range" 
                                                        min="1" 
                                                        max="5" 
                                                        value={performanceForm[rating.key]} 
                                                        onChange={(e) => setPerformanceForm({ ...performanceForm, [rating.key]: parseInt(e.target.value) })} 
                                                        className="flex-1"
                                                    />
                                                    <div className="flex items-center space-x-2">
                                                        <span className="text-sm font-medium text-gray-600">
                                                            {'â˜…'.repeat(parseInt(performanceForm[rating.key]))}{'â˜†'.repeat(5 - parseInt(performanceForm[rating.key]))}
                                                        </span>
                                                        <span className="text-lg font-bold text-brand-purple w-8">
                                                            {performanceForm[rating.key]}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div className="flex justify-between text-xs text-gray-400 mt-1">
                                                    <span>Poor</span>
                                                    <span>Excellent</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Performance Notes */}
                                <div className="mt-6">
                                    <label className="block text-sm font-medium mb-2">Performance Notes & Comments</label>
                                    <textarea 
                                        placeholder="Add detailed feedback, achievements, areas for improvement, and specific examples..."
                                        value={performanceForm.notes} 
                                        onChange={(e) => setPerformanceForm({ ...performanceForm, notes: e.target.value })} 
                                        className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" 
                                        rows="5"
                                    />
                                    <p className="text-xs text-gray-500 mt-2">Include specific examples, achievements, and constructive feedback</p>
                                </div>

                                {/* Rating Guide */}
                                <div className="mt-6 bg-blue-50 p-4 rounded-lg">
                                    <h5 className="font-semibold text-blue-800 mb-2">ðŸ“‹ Rating Scale Guide</h5>
                                    <div className="grid grid-cols-1 md:grid-cols-5 gap-2 text-sm">
                                        <div className="text-center"><strong>1 Star</strong><br/>Poor</div>
                                        <div className="text-center"><strong>2 Stars</strong><br/>Below Average</div>
                                        <div className="text-center"><strong>3 Stars</strong><br/>Meets Expectations</div>
                                        <div className="text-center"><strong>4 Stars</strong><br/>Above Average</div>
                                        <div className="text-center"><strong>5 Stars</strong><br/>Outstanding</div>
                                    </div>
                                </div>

                                <div className="flex space-x-3 mt-8">
                                    <button 
                                        onClick={handleAddPerformance} 
                                        disabled={loading}
                                        className="flex-1 bg-brand-purple hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-semibold disabled:bg-gray-300"
                                    >
                                        {loading ? 'Saving...' : 'Save Performance Record'}
                                    </button>
                                    <button 
                                        onClick={closeModal} 
                                        className="flex-1 bg-gray-300 hover:bg-gray-400 px-4 py-3 rounded-lg font-semibold"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>










